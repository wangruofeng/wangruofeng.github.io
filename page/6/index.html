<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.wangruofeng007.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":"default","style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

        <meta name="description" content="王若风的技术博客">
<meta property="og:type" content="website">
<meta property="og:title" content="王若风的技术博客">
<meta property="og:url" content="https://blog.wangruofeng007.com/page/6/index.html">
<meta property="og:site_name" content="王若风的技术博客">
<meta property="og:description" content="王若风的技术博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="王若风">
<meta property="article:tag" content="技术博客, Flutter, iOS">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.wangruofeng007.com/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

        <title>
            王若风的技术博客
        </title>
        






        <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

    <link rel="alternate" href="/atom.xml" title="王若风的技术博客" type="application/atom+xml">
</head>

    <body itemscope="itemscope" itemtype="http://schema.org/WebPage">
        <div class="container use-motion">
            <div class="headband"></div>

            <header
                class="header"
                itemscope="itemscope"
                itemtype="http://schema.org/WPHeader">
                <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">王若风的技术博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">世界尽头の冷酷仙境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
            </header>

            
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


            <main class="main">
                <div class="main-inner">
                    <div class="content-wrap">
                        

                        <div class="content index posts-expand">
                            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-sqlite-jiao-cheng-si/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-sqlite-jiao-cheng-si/" class="post-title-link" itemprop="url">SQLite 教程(四)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 23:37:18" itemprop="dateCreated datePublished" datetime="2016-01-13T23:37:18+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 16:29:01" itemprop="dateModified" datetime="2024-11-02T16:29:01+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="SQLite-运算符"><a href="#SQLite-运算符" class="headerlink" title="SQLite 运算符"></a>SQLite 运算符</h3><p><strong>SQLite 运算符是什么？</strong></p>
<p>运算符是一个保留字或字符，主要用于 SQLite 语句的 WHERE 子句中执行操作，如比较和算术运算。</p>
<p>运算符用于指定 SQLite 语句中的条件，并在语句中连接多个条件。</p>
<ul>
<li>算术运算符</li>
<li>比较运算符</li>
<li>逻辑运算符</li>
<li>位运算符</li>
</ul>
<hr>
<h4 id="SQLite-算术运算符"><a href="#SQLite-算术运算符" class="headerlink" title="SQLite 算术运算符"></a>SQLite 算术运算符</h4><p>假设变量 a&#x3D;10，变量 b&#x3D;20，则：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>加法 - 把运算符两边的值相加</td>
<td>a + b 将得到 30</td>
</tr>
<tr>
<td>-</td>
<td>减法 - 左操作数减去右操作数</td>
<td>a - b 将得到 -10</td>
</tr>
<tr>
<td>*</td>
<td>乘法 - 把运算符两边的值相乘</td>
<td>a * b 将得到 200</td>
</tr>
<tr>
<td>&#x2F;</td>
<td>除法 - 左操作数除以右操作数</td>
<td>b &#x2F; a 将得到 2</td>
</tr>
<tr>
<td>%</td>
<td>取模 - 左操作数除以右操作数后得到的余数</td>
<td>b % a will give 0</td>
</tr>
</tbody></table>
<p><strong>实例</strong></p>
<p>下面是 SQLite 算术运算符的简单实例：</p>
<pre><code>sqlite&gt; .mode line
sqlite&gt; select 10 + 20;
10 + 20 = 30


sqlite&gt; select 10 - 20;
10 - 20 = -10


sqlite&gt; select 10 * 20;
10 * 20 = 200


sqlite&gt; select 10 / 5;
10 / 5 = 2


sqlite&gt; select 12 %  5;
12 %  5 = 2
</code></pre>
<h4 id="SQLite-比较运算符"><a href="#SQLite-比较运算符" class="headerlink" title="SQLite 比较运算符"></a>SQLite 比较运算符</h4><p>假设变量 a&#x3D;10，变量 b&#x3D;20，则：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;&#x3D;</td>
<td>检查两个操作数的值是否相等，如果相等则条件为真。</td>
<td>(a &#x3D;&#x3D; b) 不为真。</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>检查两个操作数的值是否相等，如果相等则条件为真。</td>
<td>(a &#x3D; b) 不为真。</td>
</tr>
<tr>
<td>!&#x3D;</td>
<td>检查两个操作数的值是否相等，如果不相等则条件为真。</td>
<td>(a !&#x3D; b) 为真。</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>检查两个操作数的值是否相等，如果不相等则条件为真。</td>
<td>(a &lt;&gt; b) 为真。</td>
</tr>
<tr>
<td>&gt;</td>
<td>检查左操作数的值是否大于右操作数的值，如果是则条件为真。</td>
<td>(a &gt; b) 不为真。</td>
</tr>
<tr>
<td>&lt;</td>
<td>检查左操作数的值是否小于右操作数的值，如果是则条件为真。</td>
<td>(a &lt; b) 为真。</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>检查左操作数的值是否大于等于右操作数的值，如果是则条件为真。</td>
<td>(a &gt;&#x3D; b) 不为真。</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>检查左操作数的值是否小于等于右操作数的值，如果是则条件为真。</td>
<td>(a &lt;&#x3D; b) 为真。</td>
</tr>
<tr>
<td>!&lt;</td>
<td>检查左操作数的值是否不小于右操作数的值，如果是则条件为真。</td>
<td>(a !&lt; b) 为假</td>
</tr>
<tr>
<td>!&gt;</td>
<td>检查左操作数的值是否不大于右操作数的值，如果是则条件为真。</td>
<td>(a !&gt; b) 为真</td>
</tr>
</tbody></table>
<p><strong>实例</strong><br>假设 COMPANY 表有以下记录：</p>
<pre><code>ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
2           Allen       25          Texas       15000.0
3           Teddy       23          Norway      20000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<p>下面的实例演示了各种 SQLite 比较运算符的用法。</p>
<blockquote>
<p>在这里，我们使用 WHERE 子句，这将会在后边单独的一个章节中讲解，但现在您需要明白，WHERE 子句是用来设置 SELECT 语句的条件语句。</p>
</blockquote>
<p>下面的 SELECT 语句列出了 SALARY 大于 50,000.00 的所有记录：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE SALARY &gt; 50000;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
</code></pre>
<p>下面的 SELECT 语句列出了 SALARY 等于 20,000.00 的所有记录：</p>
<pre><code>sqlite&gt;  SELECT * FROM COMPANY WHERE SALARY = 20000;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
3           Teddy       23          Norway      20000.0
</code></pre>
<p>下面的 SELECT 语句列出了 SALARY 不等于 20,000.00 的所有记录：</p>
<pre><code>sqlite&gt;  SELECT * FROM COMPANY WHERE SALARY != 20000;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
2           Allen       25          Texas       15000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<p>下面的 SELECT 语句列出了 SALARY 不等于 20,000.00 的所有记录：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE SALARY &lt;&gt; 20000;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
2           Allen       25          Texas       15000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<p>下面的 SELECT 语句列出了 SALARY 大于等于 65,000.00 的所有记录：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE SALARY &gt;= 65000;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
</code></pre>
<h4 id="SQLite-逻辑运算符"><a href="#SQLite-逻辑运算符" class="headerlink" title="SQLite 逻辑运算符"></a>SQLite 逻辑运算符</h4><p>下面是 SQLite 中所有的逻辑运算符列表。</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>AND</td>
<td>AND 运算符允许在一个 SQL 语句的 WHERE 子句中的多个条件的存在。</td>
</tr>
<tr>
<td>BETWEEN</td>
<td>BETWEEN 运算符用于在给定最小值和最大值范围内的一系列值中搜索值。</td>
</tr>
<tr>
<td>EXISTS</td>
<td>EXISTS 运算符用于在满足一定条件的指定表中搜索行的存在。</td>
</tr>
<tr>
<td>IN</td>
<td>IN 运算符用于把某个值与一系列指定列表的值进行比较。</td>
</tr>
<tr>
<td>NOT IN</td>
<td>IN 运算符的对立面，用于把某个值与不在一系列指定列表的值进行比较。</td>
</tr>
<tr>
<td>LIKE</td>
<td>LIKE 运算符用于把某个值与使用通配符运算符的相似值进行比较。</td>
</tr>
<tr>
<td>GLOB</td>
<td>GLOB 运算符用于把某个值与使用通配符运算符的相似值进行比较。GLOB 与 LIKE 不同之处在于，它是大小写敏感的。</td>
</tr>
<tr>
<td>NOT</td>
<td>NOT 运算符是所用的逻辑运算符的对立面。比如 NOT EXISTS、NOT BETWEEN、NOT IN，等等。它是否定运算符。</td>
</tr>
<tr>
<td>OR</td>
<td>OR 运算符用于结合一个 SQL 语句的 WHERE 子句中的多个条件。</td>
</tr>
<tr>
<td>IS NULL</td>
<td>NULL 运算符用于把某个值与 NULL 值进行比较。</td>
</tr>
<tr>
<td>IS</td>
<td>IS 运算符与 &#x3D; 相似。</td>
</tr>
<tr>
<td>IS NOT</td>
<td>IS NOT 运算符与 !&#x3D; 相似。</td>
</tr>
<tr>
<td>||</td>
<td>连接两个不同的字符串，得到一个新的字符串。</td>
</tr>
<tr>
<td>UNIQUE</td>
<td>UNIQUE 运算符搜索指定表中的每一行，确保唯一性（无重复）。</td>
</tr>
</tbody></table>
<p><strong>实例</strong><br>假设 COMPANY 表有以下记录：</p>
<pre><code>ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
2           Allen       25          Texas       15000.0
3           Teddy       23          Norway      20000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<p>下面的实例演示了 SQLite 逻辑运算符的用法。<br>下面的 SELECT 语句列出了 AGE 大于等于 25 且工资大于等于 65000.00 的所有记录：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE AGE &gt;= 25 AND SALARY &gt;= 65000;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
</code></pre>
<p>下面的 SELECT 语句列出了 AGE 大于等于 25 或工资大于等于 65000.00 的所有记录：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE AGE &gt;= 25 OR SALARY &gt;= 65000;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
2           Allen       25          Texas       15000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
</code></pre>
<p>下面的 SELECT 语句列出了 AGE 不为 NULL 的所有记录，结果显示所有的记录，意味着没有一个记录的 AGE 等于 NULL：</p>
<pre><code>sqlite&gt;  SELECT * FROM COMPANY WHERE AGE IS NOT NULL;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
2           Allen       25          Texas       15000.0
3           Teddy       23          Norway      20000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<p>下面的 SELECT 语句列出了 NAME 以 ‘Ki’ 开始的所有记录，’Ki’ 之后的字符不做限制：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE NAME LIKE &#39;Ki%&#39;;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
6           Kim         22          South-Hall  45000.0
</code></pre>
<p>下面的 SELECT 语句列出了 NAME 以 ‘Ki’ 开始的所有记录，’Ki’ 之后的字符不做限制：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE NAME GLOB &#39;Ki*&#39;;
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
6           Kim         22          South-Hall  45000.0
</code></pre>
<p>下面的 SELECT 语句列出了 AGE 的值为 25 或 27 的所有记录：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE AGE IN ( 25, 27 );
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
2           Allen       25          Texas       15000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
</code></pre>
<p>下面的 SELECT 语句列出了 AGE 的值既不是 25 也不是 27 的所有记录：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY WHERE AGE NOT IN ( 25, 27 );
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
3           Teddy       23          Norway      20000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<p>下面的 SELECT 语句使用 SQL 子查询，子查询查找 SALARY &gt; 65000 的带有 AGE 字段的所有记录，后边的 WHERE 子句与 EXISTS 运算符一起使用，列出了外查询中的 AGE 存在于子查询返回的结果中的所有记录：</p>
<pre><code>sqlite&gt; SELECT AGE FROM COMPANY
        WHERE EXISTS (SELECT AGE FROM COMPANY WHERE SALARY &gt; 65000);
AGE
----------
32
25
23
25
27
22
24
</code></pre>
<p>下面的 SELECT 语句使用 SQL 子查询，子查询查找 SALARY &gt; 65000 的带有 AGE 字段的所有记录，后边的 WHERE 子句与 &gt; 运算符一起使用，列出了外查询中的 AGE 大于子查询返回的结果中的年龄的所有记录：</p>
<pre><code>sqlite&gt; SELECT * FROM COMPANY
        WHERE AGE &gt; (SELECT AGE FROM COMPANY WHERE SALARY &gt; 65000);
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
</code></pre>
<h4 id="SQLite-位运算符"><a href="#SQLite-位运算符" class="headerlink" title="SQLite 位运算符"></a>SQLite 位运算符</h4><p>位运算符作用于位，并逐位执行操作。真值表 &amp; 和 | 如下：</p>
<table>
<thead>
<tr>
<th>p</th>
<th>q</th>
<th>p&amp;q</th>
<th>p|q</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody></table>
<p>假设如果 A &#x3D; 60，且 B &#x3D; 13，现在以二进制格式，它们如下所示：</p>
<p>A &#x3D; 0011 1100</p>
<p>B &#x3D; 0000 1101</p>
<hr>
<p>A&amp;B &#x3D; 0000 1100</p>
<p>A|B &#x3D; 0011 1101</p>
<p>~A  &#x3D; 1100 0011</p>
<p>下表中列出了 SQLite 语言支持的位运算符。假设变量 A&#x3D;60，变量 B&#x3D;13，则：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>&amp;</td>
<td>如果同时存在于两个操作数中，二进制 AND 运算符复制一位到结果中。</td>
<td>(A &amp; B) 将得到 12，即为 0000 1100</td>
</tr>
<tr>
<td>|</td>
<td>如果存在于任一操作数中，二进制 OR 运算符复制一位到结果中。</td>
<td>(A</td>
</tr>
<tr>
<td>~</td>
<td>二进制补码运算符是一元运算符，具有”翻转”位效应。</td>
<td>(~A ) 将得到 -61，即为 1100 0011，2 的补码形式，带符号的二进制数。</td>
</tr>
<tr>
<td>&lt;&lt;</td>
<td>二进制左移运算符。左操作数的值向左移动右操作数指定的位数。</td>
<td>A &lt;&lt; 2 将得到 240，即为 1111 0000</td>
</tr>
<tr>
<td>&gt;&gt;</td>
<td>二进制右移运算符。左操作数的值向右移动右操作数指定的位数。</td>
<td>A &gt;&gt; 2 将得到 15，即为 0000 1111</td>
</tr>
</tbody></table>
<p><strong>实例</strong></p>
<p>下面的实例演示了 SQLite 位运算符的用法：</p>
<pre><code>sqlite&gt; .mode line
sqlite&gt; select 60 | 13;
60 | 13 = 61

sqlite&gt; select 60 &amp; 13;
60 &amp; 13 = 12

sqlite&gt; select  60 ^ 13;
10 * 20 = 200


sqlite&gt;  select  (~60);
(~60) = -61

sqlite&gt;  select  (60 &lt;&lt; 2);
(60 &lt;&lt; 2) = 240

sqlite&gt;  select  (60 &gt;&gt; 2);
(60 &gt;&gt; 2) = 15
</code></pre>
<p>资料整理于：<a target="_blank" rel="noopener" href="http://www.runoob.com/sqlite/sqlite-tutorial.html">RUNOOB.COM-SQLite教程</a><br>转载请注明出处。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-sqlite-jiao-cheng-san/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-sqlite-jiao-cheng-san/" class="post-title-link" itemprop="url">SQLite 教程(三)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 23:22:37" itemprop="dateCreated datePublished" datetime="2016-01-13T23:22:37+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 16:28:59" itemprop="dateModified" datetime="2024-11-02T16:28:59+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="SQLite-Insert-语句"><a href="#SQLite-Insert-语句" class="headerlink" title="SQLite Insert 语句"></a>SQLite Insert 语句</h4><p>SQLite 的 INSERT INTO 语句用于向数据库的某个表中添加新的数据行。</p>
<hr>
<p><strong>语法</strong></p>
<p>INSERT INTO 语句有两种基本语法，如下所示：</p>
<pre><code>INSERT INTO TABLE_NAME (column1, column2, column3,...columnN)]  
VALUES (value1, value2, value3,...valueN);
</code></pre>
<p>在这里，column1, column2,…columnN 是要插入数据的表中的列的名称。<br>如果要为表中的所有列添加值，您也可以不需要在 SQLite 查询中指定列名称。但要确保值的顺序与列在表中的顺序一致。SQLite 的 INSERT INTO 语法如下：</p>
<pre><code>INSERT INTO TABLE_NAME VALUES (value1,value2,value3,...valueN);
</code></pre>
<hr>
<p><strong>实例</strong></p>
<p>假设您已经在 testDB.db 中创建了 COMPANY表，如下所示：</p>
<pre><code>sqlite&gt; CREATE TABLE COMPANY(
   ID INT PRIMARY KEY     NOT NULL,
   NAME           TEXT    NOT NULL,
   AGE            INT     NOT NULL,
   ADDRESS        CHAR(50),
   SALARY         REAL
);
</code></pre>
<p>现在，下面的语句将在 COMPANY 表中创建六个记录：</p>
<pre><code>INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
VALUES (1, &#39;Paul&#39;, 32, &#39;California&#39;, 20000.00 );

INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
VALUES (2, &#39;Allen&#39;, 25, &#39;Texas&#39;, 15000.00 );

INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
VALUES (3, &#39;Teddy&#39;, 23, &#39;Norway&#39;, 20000.00 );

INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
VALUES (4, &#39;Mark&#39;, 25, &#39;Rich-Mond &#39;, 65000.00 );

INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
VALUES (5, &#39;David&#39;, 27, &#39;Texas&#39;, 85000.00 );

INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
VALUES (6, &#39;Kim&#39;, 22, &#39;South-Hall&#39;, 45000.00 );
</code></pre>
<p>您也可以使用第二种语法在 COMPANY 表中创建一个记录，如下所示：</p>
<pre><code>INSERT INTO COMPANY VALUES (7, &#39;James&#39;, 24, &#39;Houston&#39;, 10000.00 );
</code></pre>
<p>上面的所有语句将在 COMPANY 表中创建下列记录。下一章会教您如何从一个表中显示所有这些记录。</p>
<pre><code>ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
2           Allen       25          Texas       15000.0
3           Teddy       23          Norway      20000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<h4 id="使用一个表来填充另一个表"><a href="#使用一个表来填充另一个表" class="headerlink" title="使用一个表来填充另一个表"></a>使用一个表来填充另一个表</h4><p>您可以通过在一个有一组字段的表上使用 select 语句，填充数据到另一个表中。下面是语法：</p>
<pre><code>INSERT INTO first_table_name [(column1, column2, ... columnN)]
   SELECT column1, column2, ...columnN
   FROM second_table_name
   [WHERE condition];
</code></pre>
<h4 id="SQLite-Select-语句"><a href="#SQLite-Select-语句" class="headerlink" title="SQLite Select 语句"></a>SQLite Select 语句</h4><p>SQLite 的 SELECT 语句用于从 SQLite 数据库表中获取数据，以结果表的形式返回数据。这些结果表也被称为结果集。</p>
<hr>
<p><strong>语法</strong></p>
<p>SQLite 的 SELECT 语句的基本语法如下：</p>
<pre><code>SELECT column1, column2, columnN FROM table_name;
</code></pre>
<p>在这里，column1, column2…是表的字段，他们的值即是您要获取的。如果您想获取所有可用的字段，那么可以使用下面的语法：</p>
<pre><code>SELECT * FROM table_name;
</code></pre>
<hr>
<p><strong>实例</strong></p>
<p>假设 COMPANY 表有以下记录：</p>
<pre><code>ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
2           Allen       25          Texas       15000.0
3           Teddy       23          Norway      20000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<p>下面是一个实例，使用 SELECT 语句获取并显示所有这些记录。在这里，前三个命令被用来设置正确格式化的输出。</p>
<pre><code>sqlite&gt;.header on
sqlite&gt;.mode column
sqlite&gt; SELECT * FROM COMPANY;
</code></pre>
<p>最后，将得到以下的结果：</p>
<pre><code>ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
1           Paul        32          California  20000.0
2           Allen       25          Texas       15000.0
3           Teddy       23          Norway      20000.0
4           Mark        25          Rich-Mond   65000.0
5           David       27          Texas       85000.0
6           Kim         22          South-Hall  45000.0
7           James       24          Houston     10000.0
</code></pre>
<p>如果只想获取 COMPANY 表中指定的字段，则使用下面的查询：</p>
<pre><code>sqlite&gt; SELECT ID, NAME, SALARY FROM COMPANY;
</code></pre>
<p>上面的查询会产生以下结果：</p>
<pre><code>ID          NAME        SALARY
----------  ----------  ----------
1           Paul        20000.0
2           Allen       15000.0
3           Teddy       20000.0
4           Mark        65000.0
5           David       85000.0
6           Kim         45000.0
7           James       10000.0
</code></pre>
<hr>
<p><strong>设置输出列的宽度</strong></p>
<p>有时，由于要显示的列的默认宽度导致 .mode column，这种情况下，输出被截断。此时，您可以使用 .width num, num…. 命令设置显示列的宽度，如下所示：</p>
<pre><code>sqlite&gt;.width 10, 20, 10
sqlite&gt;SELECT * FROM COMPANY;
</code></pre>
<p>上面的 .width 命令设置第一列的宽度为 10，第二列的宽度为 20，第三列的宽度为 10。因此上述 SELECT 语句将得到以下结果：</p>
<pre><code>ID          NAME                  AGE         ADDRESS     SALARY
----------  --------------------  ----------  ----------  ----------
1           Paul                  32          California  20000.0
2           Allen                 25          Texas       15000.0
3           Teddy                 23          Norway      20000.0
4           Mark                  25          Rich-Mond   65000.0
5           David                 27          Texas       85000.0
6           Kim                   22          South-Hall  45000.0
7           James                 24          Houston     10000.0
</code></pre>
<p><strong>Schema 信息</strong><br>因为所有的点命令只在 SQLite 提示符中可用，所以当您进行带有 SQLite 的编程时，您要使用下面的带有 sqlite_master 表的 SELECT 语句来列出所有在数据库中创建的表：</p>
<pre><code>sqlite&gt; SELECT tbl_name FROM sqlite_master WHERE type = &#39;table&#39;;
</code></pre>
<p>假设在 testDB.db 中已经存在唯一的 COMPANY 表，则将产生以下结果：</p>
<pre><code>tbl_name
----------
COMPANY
</code></pre>
<p>您可以列出关于 COMPANY 表的完整信息，如下所示：</p>
<pre><code>sqlite&gt; SELECT sql FROM sqlite_master WHERE type = &#39;table&#39; AND tbl_name = &#39;COMPANY&#39;;
</code></pre>
<p>假设在 testDB.db 中已经存在唯一的 COMPANY 表，则将产生以下结果：</p>
<pre><code>CREATE TABLE COMPANY(
   ID INT PRIMARY KEY     NOT NULL,
   NAME           TEXT    NOT NULL,
   AGE            INT     NOT NULL,
   ADDRESS        CHAR(50),
   SALARY         REAL
)
</code></pre>
<p>资料整理于：<a target="_blank" rel="noopener" href="http://www.runoob.com/sqlite/sqlite-tutorial.html">RUNOOB.COM-SQLite教程</a><br>转载请注明出处。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-sqlite-jiao-cheng-er/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-sqlite-jiao-cheng-er/" class="post-title-link" itemprop="url">SQLite 教程(二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 23:21:34" itemprop="dateCreated datePublished" datetime="2016-01-13T23:21:34+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 16:28:56" itemprop="dateModified" datetime="2024-11-02T16:28:56+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="SQLite-数据类型"><a href="#SQLite-数据类型" class="headerlink" title="SQLite 数据类型"></a>SQLite 数据类型</h4><p>SQLite 数据类型是一个用来指定任何对象的数据类型的属性。SQLite 中的每一列，每个变量和表达式都有相关的数据类型。</p>
<p>您可以在创建表的同时使用这些数据类型。SQLite 使用一个更普遍的动态类型系统。在 SQLite 中，值的数据类型与值本身是相关的，而不是与它的容器相关。</p>
<h4 id="SQLite-存储类"><a href="#SQLite-存储类" class="headerlink" title="SQLite 存储类"></a>SQLite 存储类</h4><p>每个存储在 SQLite 数据库中的值都具有以下存储类之一：</p>
<table>
<thead>
<tr>
<th>存储类</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>NULL</td>
<td>值是一个 NULL 值。</td>
</tr>
<tr>
<td>INTEGER</td>
<td>值是一个带符号的整数，根据值的大小存储在 1、2、3、4、6 或 8 字节中。</td>
</tr>
<tr>
<td>REAL</td>
<td>值是一个浮点值，存储为 8 字节的 IEEE 浮点数字。</td>
</tr>
<tr>
<td>TEXT</td>
<td>值是一个文本字符串，使用数据库编码（UTF-8、UTF-16BE 或</td>
</tr>
<tr>
<td>BLOB</td>
<td>值是一个 blob 数据，完全根据它的输入存储。</td>
</tr>
</tbody></table>
<p>SQLite 的存储类稍微比数据类型更普遍。INTEGER 存储类，例如，包含 6 种不同的不同长度的整数数据类型。</p>
<hr>
<h4 id="SQLite-Affinity-类型"><a href="#SQLite-Affinity-类型" class="headerlink" title="SQLite Affinity 类型"></a>SQLite Affinity 类型</h4><p>SQLite 支持列上的类型 affinity 概念。任何列仍然可以存储任何类型的数据，但列的首选存储类是它的 <strong>affinity</strong>。在 SQLite3 数据库中，每个表的列分配为以下类型的 affinity 之一：</p>
<table>
<thead>
<tr>
<th>Affinity</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>TEXT</td>
<td>该列使用存储类 NULL、TEXT 或 BLOB 存储所有数据。</td>
</tr>
<tr>
<td>NUMERIC</td>
<td>该列可以包含使用所有五个存储类的值。</td>
</tr>
<tr>
<td>INTEGER</td>
<td>与带有 NUMERIC affinity 的列相同，在 CAST 表达式中带有异常。</td>
</tr>
<tr>
<td>REAL</td>
<td>与带有 NUMERIC affinity 的列相似，不同的是，它会强制把整数值转换为浮点表示。</td>
</tr>
<tr>
<td>NONE</td>
<td>带有 affinity NONE 的列，不会优先使用哪个存储类，也不会尝试把数据从一个存储类强制转换为另一个存储类。</td>
</tr>
</tbody></table>
<h4 id="SQLite-Affinity-及类型名称"><a href="#SQLite-Affinity-及类型名称" class="headerlink" title="SQLite Affinity 及类型名称"></a>SQLite Affinity 及类型名称</h4><p>下表列出了当创建 SQLite3 表时可使用的各种数据类型名称，同时也显示了相应的应用 Affinity：</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>Affinity</th>
</tr>
</thead>
<tbody><tr>
<td>INT <br> INTEGERTINYINT <br> SMALLINT <br> MEDIUMINT <br> BIGINT <br> UNSIGNED BIG INT <br> INT2 <br> INT8  <br></td>
<td>INTEGER</td>
</tr>
<tr>
<td>CHARACTER(20) <br> VARCHAR(255) <br> VARYING CHARACTER(255) <br> NCHAR(55) <br> NATIVE CHARACTER(70) <br> NVARCHAR(100) <br> TEXT <br> CLOB</td>
<td>TEXT</td>
</tr>
<tr>
<td>BLOB <br> no datatype specified</td>
<td>NONE</td>
</tr>
<tr>
<td>REAL <br> DOUBLE <br> DOUBLE PRECISION <br> FLOAT</td>
<td>REAL</td>
</tr>
<tr>
<td>NUMERIC <br> DECIMAL(10,5) <br> BOOLEAN <br> DATE <br> DATETIME</td>
<td>NUMERIC</td>
</tr>
</tbody></table>
<hr>
<h4 id="Boolean-数据类型"><a href="#Boolean-数据类型" class="headerlink" title="Boolean 数据类型"></a>Boolean 数据类型</h4><p>SQLite 没有单独的 Boolean 存储类。相反，布尔值被存储为整数 0（false）和 1（true）。</p>
<hr>
<h4 id="Date-与-Time-数据类型"><a href="#Date-与-Time-数据类型" class="headerlink" title="Date 与 Time 数据类型"></a>Date 与 Time 数据类型</h4><p>SQLite 没有一个单独的用于存储日期和&#x2F;或时间的存储类，但 SQLite 能够把日期和时间存储为 TEXT、REAL 或 INTEGER 值。</p>
<table>
<thead>
<tr>
<th>存储类</th>
<th>日期格式</th>
</tr>
</thead>
<tbody><tr>
<td>TEXT</td>
<td>格式为 “YYYY-MM-DD HH:MM:SS.SSS” 的日期。</td>
</tr>
<tr>
<td>REAL</td>
<td>从公元前 4714 年 11 月 24 日格林尼治时间的正午开始算起的天数。</td>
</tr>
<tr>
<td>INTEGER</td>
<td>从 1970-01-01 00:00:00 UTC 算起的秒数。</td>
</tr>
</tbody></table>
<p>您可以以任何上述格式来存储日期和时间，并且可以使用内置的日期和时间函数来自由转换不同格式。</p>
<h4 id="SQLite-创建数据库"><a href="#SQLite-创建数据库" class="headerlink" title="SQLite 创建数据库"></a>SQLite 创建数据库</h4><p>SQLite 的 sqlite3 命令被用来创建新的 SQLite 数据库。您不需要任何特殊的权限即可创建一个数据。</p>
<hr>
<p><strong>语法</strong></p>
<p>sqlite3 命令的基本语法如下：</p>
<pre><code>$sqlite3 DatabaseName.db
</code></pre>
<p>通常情况下，数据库名称在 RDBMS 内应该是唯一的。</p>
<p><strong>实例</strong></p>
<p>如果您想创建一个新的数据库 &lt;testDB.db&gt;，SQLITE3 语句如下所示：</p>
<pre><code>$sqlite3 testDB.db
SQLite version 3.8.10.2 2015-05-20 18:17:19
Enter &quot;.help&quot; for usage hints.
sqlite&gt;
</code></pre>
<p>上面的命令将在当前目录下创建一个文件 testDB.db。该文件将被 SQLite 引擎用作数据库。如果您已经注意到 sqlite3 命令在成功创建数据库文件之后，将提供一个 sqlite&gt; 提示符。<br>一旦数据库被创建，您就可以使用 SQLite 的 .databases 命令来检查它是否在数据库列表中，如下所示：</p>
<pre><code>sqlite&gt;.databases
seq  name             file                                                      
---- ---------------- --------------------------------------------
0    main             /Users/wangruofeng/Documents/SQLitePractice/testDB.db
</code></pre>
<p>您可以使用 SQLite .quit 命令退出 sqlite 提示符，如下所示：</p>
<pre><code>sqlite&gt;.quit
$
</code></pre>
<h4 id="dump-命令"><a href="#dump-命令" class="headerlink" title=".dump 命令"></a>.dump 命令</h4><p>您可以在命令提示符中使用 SQLite .dump 点命令来导出完整的数据库在一个文本文件中，如下所示：</p>
<pre><code>$sqlite3 testDB.db .dump &gt; testDB.sql
</code></pre>
<p>上面的命令将转换整个 testDB.db 数据库的内容到 SQLite 的语句中，并将其转储到 ASCII 文本文件 testDB.sql 中。您可以通过简单的方式从生成的 testDB.sql 恢复，如下所示：</p>
<pre><code>$sqlite3 testDB.db &lt; testDB.sql
</code></pre>
<p>此时的数据库是空的，一旦数据库中有表和数据，您可以尝试上述两个程序。现在，让我们继续学习下一章。</p>
<h4 id="SQLite-附加数据库"><a href="#SQLite-附加数据库" class="headerlink" title="SQLite 附加数据库"></a>SQLite 附加数据库</h4><p>假设这样一种情况，当在同一时间有多个数据库可用，您想使用其中的任何一个。SQLite 的 ATTACH DTABASE 语句是用来选择一个特定的数据库，使用该命令后，所有的 SQLite 语句将在附加的数据库下执行。相当于给数据库取一个别名</p>
<hr>
<p><strong>语法</strong></p>
<p>SQLite 的 ATTACH DATABASE 语句的基本语法如下：</p>
<pre><code>ATTACH DATABASE &#39;DatabaseName&#39; As &#39;Alias-Name&#39;;
</code></pre>
<p>如果数据库尚未被创建，上面的命令将创建一个数据库，如果数据库已存在，则把数据库文件名称与逻辑数据库 ‘Alias-Name’ 绑定在一起。</p>
<hr>
<p><strong>实例</strong><br>如果想附加一个现有的数据库 testDB.db，则 ATTACH DATABASE 语句将如下所示：</p>
<pre><code>sqlite&gt; ATTACH DATABASE &#39;testDB.db&#39; as &#39;TEST&#39;;
</code></pre>
<p>使用 SQLite .database 命令来显示附加的数据库。</p>
<pre><code>sqlite&gt; .database
seq  name             file
---  ---------------  ----------------------
0    main             /home/sqlite/testDB.db
2    test             /home/sqlite/testDB.db
</code></pre>
<p>数据库名称 main 和 temp 被保留用于主数据库和存储临时表及其他临时数据对象的数据库。这两个数据库名称可用于每个数据库连接，且不应该被用于附加，否则将得到一个警告消息，如下所示：</p>
<pre><code>sqlite&gt;  ATTACH DATABASE &#39;testDB.db&#39; as &#39;TEMP&#39;;
Error: database TEMP is already in use
sqlite&gt;  ATTACH DATABASE &#39;testDB.db&#39; as &#39;main&#39;;
Error: database main is already in use
</code></pre>
<hr>
<h4 id="SQLite-分离数据库"><a href="#SQLite-分离数据库" class="headerlink" title="SQLite 分离数据库"></a>SQLite 分离数据库</h4><p>SQLite的 <strong>DETACH DTABASE</strong> 语句是用来把命名数据库从一个数据库连接分离和游离出来，连接是之前使用 ATTACH 语句附加的。如果同一个数据库文件已经被附加上多个别名，DETACH 命令将只断开给定名称的连接，而其余的仍然有效。您无法分离 main 或 temp 数据库。</p>
<blockquote>
<p>如果数据库是在内存中或者是临时数据库，则该数据库将被摧毁，且内容将会丢失。</p>
</blockquote>
<p><strong>语法</strong></p>
<p>SQLite 的 DETACH DATABASE ‘Alias-Name’ 语句的基本语法如下：</p>
<pre><code>DETACH DATABASE &#39;Alias-Name&#39;;
</code></pre>
<p>在这里，’Alias-Name’ 与您之前使用 ATTACH 语句附加数据库时所用到的别名相同。</p>
<p><strong>实例</strong></p>
<p>假设在前面的章节中您已经创建了一个数据库，并给它附加了 ‘test’ 和 ‘currentDB’，使用 .database&#x2F;.databases 命令，我们可以看到：</p>
<pre><code>sqlite&gt; .databases
seq  name             file
---  ---------------  ----------------------
0    main             /home/sqlite/testDB.db
2    test             /home/sqlite/testDB.db
3    currentDB        /home/sqlite/testDB.db
</code></pre>
<p>现在，让我们尝试把 ‘currentDB’ 从 testDB.db 中分离出来，如下所示：</p>
<pre><code>sqlite&gt; DETACH DATABASE &#39;currentDB&#39;;
</code></pre>
<p>现在，如果检查当前附加的数据库，您会发现，testDB.db 仍与 ‘test’ 和 ‘main’ 保持连接。</p>
<pre><code>sqlite&gt; .databases
seq  name             file
---  ---------------  ----------------------
0    main             /home/sqlite/testDB.db
2    test             /home/sqlite/testDB.db
</code></pre>
<hr>
<h4 id="SQLite-创建表"><a href="#SQLite-创建表" class="headerlink" title="SQLite 创建表"></a>SQLite 创建表</h4><p>SQLite 的 CREATE TABLE 语句用于在任何给定的数据库创建一个新表。创建基本表，涉及到命名表、定义列及每一列的数据类型。</p>
<hr>
<p><strong>语法</strong></p>
<p>CREATE TABLE 语句的基本语法如下：</p>
<pre><code>CREATE TABLE database_name.table_name(
   column1 datatype  PRIMARY KEY(one or more columns),
   column2 datatype,
   column3 datatype,
   .....
   columnN datatype,
);
</code></pre>
<p>CREATE TABLE 是告诉数据库系统创建一个新表的关键字。CREATE TABLE 语句后跟着表的唯一的名称或标识。您也可以选择指定带有 table_name 的 <em>database_name</em>。</p>
<p><strong>实例</strong></p>
<p>下面是一个实例，它创建了一个 COMPANY 表，ID 作为主键，NOT NULL 的约束表示在表中创建纪录时这些字段不能为 NULL：</p>
<pre><code>sqlite&gt; CREATE TABLE COMPANY(
   ID INT PRIMARY KEY     NOT NULL,
   NAME           TEXT    NOT NULL,
   AGE            INT     NOT NULL,
   ADDRESS        CHAR(50),
   SALARY         REAL
);
</code></pre>
<p>让我们再创建一个表，我们将在随后章节的练习中使用：</p>
<pre><code>sqlite&gt; CREATE TABLE DEPARTMENT(
   ID INT PRIMARY KEY      NOT NULL,
   DEPT           CHAR(50) NOT NULL,
   EMP_ID         INT      NOT NULL
);
</code></pre>
<p>您可以使用 SQLIte 命令中的 .tables&#x2F;.table 命令来验证表是否已成功创建，该命令用于列出附加数据库中的所有表。</p>
<pre><code>sqlite&gt; .tables
COMPANY          DEPARTMENT       TEST.COMPANY     TEST.DEPARTMENT
</code></pre>
<p>在这里，可以看到 COMPANY 表出现两次，一个是主数据库的 COMPANY 表，一个是为 testDB.db 创建的 ‘test’ 别名的 test.COMPANY 表。您可以使用 SQLite .schema 命令得到表的完整信息，如下所示：</p>
<pre><code>sqlite&gt;.schema COMPANY
CREATE TABLE COMPANY(
   ID INT PRIMARY KEY     NOT NULL,
   NAME           TEXT    NOT NULL,
   AGE            INT     NOT NULL,
   ADDRESS        CHAR(50),
   SALARY         REAL
);
</code></pre>
<h4 id="SQLite-删除表"><a href="#SQLite-删除表" class="headerlink" title="SQLite 删除表"></a>SQLite 删除表</h4><p>SQLite 的 DROP TABLE 语句用来删除表定义及其所有相关数据、索引、触发器、约束和该表的权限规范。</p>
<blockquote>
<p>使用此命令时要特别注意，因为一旦一个表被删除，表中所有信息也将永远丢失。</p>
</blockquote>
<hr>
<p><strong>语法</strong></p>
<p>DROP TABLE 语句的基本语法如下。您可以选择指定带有表名的数据库名称，如下所示：</p>
<pre><code>DROP TABLE database_name.table_name;
</code></pre>
<p><strong>实例</strong></p>
<p>让我们先确认 COMPANY 表已经存在，然后我们将其从数据库中删除。</p>
<pre><code>sqlite&gt; .tables
COMPANY       test.COMPANY
</code></pre>
<p>这意味着 COMPANY 表已存在数据库中，接下来让我们把它从数据库中删除，如下：</p>
<pre><code>sqlite&gt; DROP TABLE COMPANY;
sqlite&gt;
</code></pre>
<p>现在，如果尝试 .TABLES 命令，那么将无法找到 COMPANY 表了：</p>
<pre><code>sqlite&gt; .tables
sqlite&gt;
</code></pre>
<p>显示结果为空，意味着已经成功从数据库删除表。</p>
<p>资料整理于：<a target="_blank" rel="noopener" href="http://www.runoob.com/sqlite/sqlite-tutorial.html">RUNOOB.COM-SQLite教程</a><br>转载请注明出处。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-sqlite-jiao-cheng-[?%5D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-sqlite-jiao-cheng-%5B?%5D/" class="post-title-link" itemprop="url">SQLite 教程(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 23:18:15" itemprop="dateCreated datePublished" datetime="2016-01-13T23:18:15+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 16:28:53" itemprop="dateModified" datetime="2024-11-02T16:28:53+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h4><p>SQLite 是一个软件库，实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。SQLite 是在世界上最广泛部署的 SQL 数据库引擎。SQLite 源代码不受版权限制。<br>本教程将告诉您如何使用 SQLite 编程，并让你迅速上手。</p>
<h4 id="什么是-SQLite？"><a href="#什么是-SQLite？" class="headerlink" title="什么是 SQLite？"></a>什么是 SQLite？</h4><p>SQLite是一个进程内的库，实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。它是一个零配置的数据库，这意味着与其他数据库一样，您不需要在系统中配置。<br>就像其他数据库，SQLite 引擎不是一个独立的进程，可以按应用程序需求进行静态或动态连接。SQLite 直接访问其存储文件</p>
<h4 id="为什么要用-SQLite？"><a href="#为什么要用-SQLite？" class="headerlink" title="为什么要用 SQLite？"></a>为什么要用 SQLite？</h4><ul>
<li>不需要一个单独的服务器进程或操作的系统（无服务器的）。</li>
<li>SQLite 不需要配置，这意味着不需要安装或管理。</li>
<li>一个完整的 SQLite 数据库是存储在一个单一的跨平台的磁盘文件。</li>
<li>SQLite 是非常小的，是轻量级的，完全配置时小于 400KiB，省略可选功能配置时小于250KiB。</li>
<li>SQLite 是自给自足的，这意味着不需要任何外部的依赖。</li>
<li>SQLite 事务是完全兼容 ACID 的，允许从多个进程或线程安全访问。</li>
<li>SQLite 支持 SQL92（SQL2）标准的大多数查询语言的功能。</li>
<li>SQLite 使用 ANSI-C 编写的，并提供了简单和易于使用的 API。</li>
<li>SQLite 可在 UNIX（Linux, Mac OS-X, Android, iOS）和 Windows（Win32, WinCE, WinRT）中运行。</li>
</ul>
<h4 id="SQLite-命令"><a href="#SQLite-命令" class="headerlink" title="SQLite 命令"></a>SQLite 命令</h4><p>与关系数据库进行交互的标准 SQLite 命令类似于 SQL。命令包括 CREATE、SELECT、INSERT、UPDATE、DELETE 和 DROP。这些命令基于它们的操作性质可分为以下几种：</p>
<h4 id="DDL-数据定义语言"><a href="#DDL-数据定义语言" class="headerlink" title="DDL - 数据定义语言"></a>DDL - 数据定义语言</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>CREATE</td>
<td>创建一个新的表，一个表的视图，或者数据库中的其他对象。</td>
</tr>
<tr>
<td>ALTER</td>
<td>修改数据库中的某个已有的数据库对象，比如一个表。</td>
</tr>
<tr>
<td>DROP</td>
<td>删除整个表，或者表的视图，或者数据库中的其他对象。</td>
</tr>
</tbody></table>
<h4 id="DML-数据操作语言"><a href="#DML-数据操作语言" class="headerlink" title="DML - 数据操作语言"></a>DML - 数据操作语言</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td>创建一条记录。</td>
</tr>
<tr>
<td>UPDATE</td>
<td>修改记录。</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除记录。</td>
</tr>
</tbody></table>
<h4 id="DQL-数据查询语言"><a href="#DQL-数据查询语言" class="headerlink" title="DQL - 数据查询语言"></a>DQL - 数据查询语言</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>SELECT</td>
<td>从一个或多个表中检索某些记录。</td>
</tr>
</tbody></table>
<h4 id="在-Mac-OS-X-上安装-SQLite"><a href="#在-Mac-OS-X-上安装-SQLite" class="headerlink" title="在 Mac OS X 上安装 SQLite"></a>在 Mac OS X 上安装 SQLite</h4><p>最新版本的 Mac OS X 会预安装 SQLite，但是如果没有可用的安装，只需按照如下步骤进行：<br>请访问 <a target="_blank" rel="noopener" href="http://www.sqlite.org/download.html">SQLite 下载页面</a>，从源代码区下载 sqlite-autoconf-*.tar.gz。<br>步骤如下：</p>
<pre><code>$tar xvfz sqlite-autoconf-3071502.tar.gz
$cd sqlite-autoconf-3071502
$./configure --prefix=/usr/local
$make
$make install
</code></pre>
<p>上述步骤将在 Mac OS X 机器上安装 SQLite，您可以使用下列命令进行验证：</p>
<pre><code>$sqlite3
SQLite version 3.7.15.2 2013-01-09 11:53:05
Enter &quot;.help&quot; for instructions
Enter SQL statements terminated with a &quot;;&quot;
sqlite&gt;
</code></pre>
<p>最后，在 SQLite 命令提示符下，使用 SQLite 命令做练习。</p>
<h4 id="SQLite语法"><a href="#SQLite语法" class="headerlink" title="SQLite语法"></a>SQLite语法</h4><p><strong>大小写敏感性</strong></p>
<p>有个重要的点值得注意，SQLite 是不区分大小写的，但也有一些命令是大小写敏感的，比如 GLOB 和 glob 在 SQLite 的语句中有不同的含义。</p>
<p><strong>注释</strong></p>
<p>SQLite 注释是附加的注释，可以在 SQLite 代码中添加注释以增加其可读性，他们可以出现在任何空白处，包括在表达式内和其他 SQL 语句的中间，但它们不能嵌套。<br>SQL 注释以两个连续的 “-“ 字符（ASCII 0x2d）开始，并扩展至下一个换行符（ASCII 0x0a）或直到输入结束，以先到者为准。<br>您也可以使用 C 风格的注释，以 “&#x2F;*“ 开始，并扩展至下一个 “*&#x2F;“ 字符对或直到输入结束，以先到者为准。SQLite的注释可以跨越多行。</p>
<h4 id="SQLite-语句"><a href="#SQLite-语句" class="headerlink" title="SQLite 语句"></a>SQLite 语句</h4><p>所有的 SQLite 语句可以以任何关键字开始，如 SELECT、INSERT、UPDATE、DELETE、ALTER、DROP 等，所有的语句以分号（;）结束。</p>
<p>SQLite ANALYZE 语句：</p>
<pre><code>ANALYZE;
or
ANALYZE database_name;
or
ANALYZE database_name.table_name;
</code></pre>
<p>SQLite AND&#x2F;OR 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  CONDITION-1 &#123;AND|OR&#125; CONDITION-2;
</code></pre>
<p>SQLite ALTER TABLE 语句：</p>
<pre><code>ALTER TABLE table_name ADD COLUMN column_def...;
SQLite ALTER TABLE 语句（Rename）：
ALTER TABLE table_name RENAME TO new_table_name;
</code></pre>
<p>SQLite ATTACH DATABASE 语句：</p>
<pre><code>ATTACH DATABASE &#39;DatabaseName&#39; As &#39;Alias-Name&#39;;
SQLite BEGIN TRANSACTION 语句：
BEGIN;
or
BEGIN EXCLUSIVE TRANSACTION;
</code></pre>
<p>SQLite BETWEEN 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  column_name BETWEEN val-1 AND val-2;
</code></pre>
<p>SQLite COMMIT 语句：</p>
<pre><code>COMMIT;
</code></pre>
<p>SQLite CREATE INDEX 语句：</p>
<pre><code>CREATE INDEX index_name
ON table_name ( column_name COLLATE NOCASE );
</code></pre>
<p>SQLite CREATE UNIQUE INDEX 语句：</p>
<pre><code>CREATE UNIQUE INDEX index_name
ON table_name ( column1, column2,...columnN);
</code></pre>
<p>SQLite CREATE TABLE 语句：</p>
<pre><code>CREATE TABLE table_name(
   column1 datatype,
   column2 datatype,
   column3 datatype,
   .....
   columnN datatype,
   PRIMARY KEY( one or more columns )
);
</code></pre>
<p>SQLite CREATE TRIGGER 语句：</p>
<pre><code>CREATE TRIGGER database_name.trigger_name
BEFORE INSERT ON table_name FOR EACH ROW
BEGIN
   stmt1;
   stmt2;
   ....
END;
</code></pre>
<p>SQLite CREATE VIEW 语句：</p>
<pre><code>CREATE VIEW database_name.view_name  AS
SELECT statement....;
</code></pre>
<p>SQLite CREATE VIRTUAL TABLE 语句：</p>
<pre><code>CREATE VIRTUAL TABLE database_name.table_name USING weblog( access.log );
or
CREATE VIRTUAL TABLE database_name.table_name USING fts3( );
</code></pre>
<p>SQLite COMMIT TRANSACTION 语句：</p>
<pre><code>COMMIT;
SQLite COUNT 子句：
SELECT COUNT(column_name)
FROM   table_name
WHERE  CONDITION;
</code></pre>
<p>SQLite DELETE 语句：</p>
<pre><code>DELETE FROM table_name
WHERE  &#123;CONDITION&#125;;
</code></pre>
<p>SQLite DETACH DATABASE 语句：</p>
<pre><code>DETACH DATABASE &#39;Alias-Name&#39;;
</code></pre>
<p>SQLite DISTINCT 子句：</p>
<pre><code>SELECT DISTINCT column1, column2....columnN
FROM   table_name;
</code></pre>
<p>SQLite DROP INDEX 语句：</p>
<pre><code>DROP INDEX database_name.index_name;
</code></pre>
<p>SQLite DROP TABLE 语句：</p>
<pre><code>DROP TABLE database_name.table_name;
</code></pre>
<p>SQLite DROP VIEW 语句：</p>
<pre><code>DROP INDEX database_name.view_name;
</code></pre>
<p>SQLite DROP TRIGGER 语句：</p>
<pre><code>DROP INDEX database_name.trigger_name;
</code></pre>
<p>SQLite EXISTS 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  column_name EXISTS (SELECT * FROM   table_name );
</code></pre>
<p>SQLite EXPLAIN 语句：</p>
<pre><code>EXPLAIN INSERT statement...;
or
EXPLAIN QUERY PLAN SELECT statement...;
</code></pre>
<p>SQLite GLOB 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  column_name GLOB &#123; PATTERN &#125;;
</code></pre>
<p>SQLite GROUP BY 子句：</p>
<pre><code>SELECT SUM(column_name)
FROM   table_name
WHERE  CONDITION
GROUP BY column_name;
</code></pre>
<p>SQLite HAVING 子句：</p>
<pre><code>SELECT SUM(column_name)
FROM   table_name
WHERE  CONDITION
GROUP BY column_name
HAVING (arithematic function condition);
</code></pre>
<p>SQLite INSERT INTO 语句：</p>
<pre><code>INSERT INTO table_name( column1, column2....columnN)
VALUES ( value1, value2....valueN);
</code></pre>
<p>SQLite IN 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  column_name IN (val-1, val-2,...val-N);
</code></pre>
<p>SQLite Like 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  column_name LIKE &#123; PATTERN &#125;;
</code></pre>
<p>SQLite NOT IN 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  column_name NOT IN (val-1, val-2,...val-N);
</code></pre>
<p>SQLite ORDER BY 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  CONDITION
ORDER BY column_name &#123;ASC|DESC&#125;;
</code></pre>
<p>SQLite PRAGMA 语句：</p>
<pre><code>PRAGMA pragma_name;

For example:

PRAGMA page_size;
PRAGMA cache_size = 1024;
PRAGMA table_info(table_name);
</code></pre>
<p>SQLite RELEASE SAVEPOINT 语句：</p>
<pre><code>RELEASE savepoint_name;
</code></pre>
<p>SQLite REINDEX 语句：</p>
<pre><code>REINDEX collation_name;
REINDEX database_name.index_name;
REINDEX database_name.table_name;
</code></pre>
<p>SQLite ROLLBACK 语句：</p>
<pre><code>ROLLBACK;
or
ROLLBACK TO SAVEPOINT savepoint_name;
</code></pre>
<p>SQLite SAVEPOINT 语句：</p>
<pre><code>SAVEPOINT savepoint_name;
SQLite SELECT 语句：
SELECT column1, column2....columnN
FROM   table_name;
</code></pre>
<p>SQLite UPDATE 语句：</p>
<pre><code>UPDATE table_name
SET column1 = value1, column2 = value2....columnN=valueN
[ WHERE  CONDITION ];
</code></pre>
<p>SQLite VACUUM 语句：</p>
<pre><code>VACUUM;
</code></pre>
<p>SQLite WHERE 子句：</p>
<pre><code>SELECT column1, column2....columnN
FROM   table_name
WHERE  CONDITION;
</code></pre>
<p>资料整理于：<a target="_blank" rel="noopener" href="http://www.runoob.com/sqlite/sqlite-tutorial.html">RUNOOB.COM-SQLite教程</a><br>转载请注明出处。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-cocoapodsshi-yong-zhi-nan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-cocoapodsshi-yong-zhi-nan/" class="post-title-link" itemprop="url">CocoaPods 使用指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 05:51:18" itemprop="dateCreated datePublished" datetime="2016-01-13T05:51:18+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 16:28:01" itemprop="dateModified" datetime="2024-11-02T16:28:01+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>663</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>CocoaPods是iOS最常用的第三方类库管理工具，绝大部分有名的开源类库<br>支持CocoaPods。</p>
<p>CocoaPods是用Ruby实现的，要使用它首先需要有Ruby的环境。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>幸亏OS X系统默认已经可以运行Ruby了，我们只需执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install cocoapods</span><br></pre></td></tr></table></figure>

<p>由于某些原因，执行时会出现下面的错误提示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ERROR :Could not find a valid gem `cocoapods` (&gt;= 0), here is why:</span><br><span class="line">        Unable to download data from https://rubygems.org/ - Errno::EPIPI:</span><br><span class="line">        Broken pipe - SSL_connect</span><br><span class="line">(https://rubygems.org/lastest_specs.4.8.gz)</span><br></pre></td></tr></table></figure>

<p>安装成功后，接着执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod setup</span><br></pre></td></tr></table></figure>

<p>如果Ruby环境不够新，可能需要更新以下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem update --system</span><br></pre></td></tr></table></figure>

<p>至此安装就完成了，我们可以尝试搜索一个第三方类库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod search AFNetworking</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>使用CocoaPods第一步，是在当前项目下，新建一个Podfile文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch Podfile</span><br></pre></td></tr></table></figure>

<p>然后利用vim打开Podfile文件编辑，加入你想要的类库，格式如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">platform <span class="symbol">:ios</span></span><br><span class="line">pod  <span class="string">&#x27;Reachability&#x27;</span>, <span class="string">&#x27;3.1.0&#x27;</span></span><br><span class="line"></span><br><span class="line">platform <span class="symbol">:ios</span>, <span class="string">&#x27;6.0&#x27;</span></span><br><span class="line">pod <span class="string">&#x27;JSONKit&#x27;</span>, <span class="string">&#x27;1.4&#x27;</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;~&gt; 2.3.1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如果是拷贝别人的项目，或是一个很久没打开过的项目，可能需要先执行一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod update</span><br></pre></td></tr></table></figure>

<p>最后一步，执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure>

<p>当终端出现类似下面的提示后，就代表成功了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!] From now no use `Sample0814.xcworkspace`.</span><br></pre></td></tr></table></figure>

<p>这个时候会看到项目文件夹多了一个xxx.xcworkspace,以后要通过这个文件<br>打开项目，老项目xxx.xcodeproj不再使用。</p>
<blockquote>
<ol>
<li>上面的每一步都可能出现问题，但大部分问题都是因为局域网的原因，用一个网速稳<br>定的境外VPN可破</li>
<li>如果上面因为权限问题安装失败，必须每次都要删除</li>
</ol>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /User/loginname/Library/Caches/CocoaPods/</span><br></pre></td></tr></table></figure>
<p>因为这个缓冲中会存下你的github的东西，造成每次调用上次权限问题的缓存。</p>
<blockquote>
<ol start="3">
<li>关于Podfile文件编辑时，第三方版本号的各种写法:</li>
</ol>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>      		 <span class="comment"># 不显式指定依赖库版本，表示每次都获取最新版本</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;2.0&#x27;</span>        <span class="comment"># 只使用2.0版本</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;&gt;2.0&#x27;</span>       <span class="comment"># 使用高于2.0的版本</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;&gt;=2.0&#x27;</span>      <span class="comment"># 使用大于或等于2.0的版本</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;&lt;2.0&#x27;</span>       <span class="comment"># 使用小于2.0的版本</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;&lt;=2.0&#x27;</span>      <span class="comment"># 使用小于或等于2.0的版本</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;~&gt;0.1.2&#x27;</span>    <span class="comment"># 使用大于等于0.1.2但小于0.2的版本，相当于&gt;=0.1.2并且&lt;0.2.0</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;~&gt;0.1&#x27;</span>      <span class="comment"># 使用大于等于0.1但小于1.0的版本</span></span><br><span class="line">pod <span class="string">&#x27;AFNetworking&#x27;</span>, <span class="string">&#x27;~&gt;0&#x27;</span>        <span class="comment"># 高于0的版本，写这个限制和什么都不写是一个效果，都表示使用最新版本</span></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="http://semver.org/">语义化版本 2.0.0</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-get-and-post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-get-and-post/" class="post-title-link" itemprop="url">GET&amp;POST</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 05:48:10" itemprop="dateCreated datePublished" datetime="2016-01-13T05:48:10+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 11:36:52" itemprop="dateModified" datetime="2024-11-02T11:36:52+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>715</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>GET和POST是两种最常用的与服务器进行交互的HTTP方法 .</p>
</blockquote>
<h3 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h3><ul>
<li>GET的语义是获取指定的URL资源, 将数据按照 variable &#x3D; value 的形式, 添加到action所指向的URL后面, 并且两者使用 ‘ ? ‘连接, 各变量之间使用 ‘ &amp; ‘连接 .</li>
<li>对用户来说不安全, 因为在传输过程中, 数据被放在请求的URL中.</li>
<li>传输的数据量小, 这主要是因为受URL长度限制.</li>
</ul>
<h3 id="URL长度限制"><a href="#URL长度限制" class="headerlink" title="URL长度限制"></a>URL长度限制</h3><p> 在http协议中，其实并没有对url长度作出限制，往往url的最大长度和用户浏览器和Web服务器有关，不一样的浏览器，能接受的最大长度往往是不一样的，当然，不一样的Web服务器能够处理的最大长度的URL的能力也是不一样的。</p>
<pre><code>IE浏览器对URL的最大限制为2083个字符，如果超过这个数字，提交按钮没有任何反应。

Firefox浏览器URL的长度限制为65,536个字符 ;

Apache(Server)能够接受的最大URL长度为8192个字符 ;

如果浏览器的编码为UTF8的话，一个汉字最终编码后的字符长度为9个字符。
</code></pre>
<p>GET请求示例</p>
<p><img src="http://static.oschina.net/uploads/space/2014/0602/164040_3SOT_1774273.png" alt="GetRequest"></p>
<h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><ul>
<li>POST语义是向指定URL的资源添加数据.</li>
<li>将数据放在数据体中, 按照变量和值相对应的方式, 传递到action所指向的URL.</li>
<li>所有数据对用户来说不可见.</li>
<li>可以传输大量数据, 上传文件只能使用POST.</li>
</ul>
<p>POST请求示例</p>
<p><img src="http://static.oschina.net/uploads/space/2014/0602/164119_VRKY_1774273.png" alt="PostRequest"></p>
<h3 id="在浏览器中判断GET-POST请求"><a href="#在浏览器中判断GET-POST请求" class="headerlink" title="在浏览器中判断GET&amp;POST请求"></a>在浏览器中判断GET&amp;POST请求</h3><p>因为POST请求会向服务器发送数据体, 因此刷新页面时会出现提示窗口. 而GET请求不会向服务器发送数据体, 因此没有提示 .</p>
<p>从请求本质来看, GET请求要比POST更安全, 效率也会更高 .(对服务器而言)</p>
<h3 id="iOS网络发送网络请求的步骤"><a href="#iOS网络发送网络请求的步骤" class="headerlink" title="iOS网络发送网络请求的步骤"></a>iOS网络发送网络请求的步骤</h3><ol>
<li><p>实例化URL( 网络资源 ) ;</p>
</li>
<li><p>根据URL建立URLRequest ( 网络请求 ) ;</p>
<p> 默认为GET请求; 对于POST请求,  需要创建请求的数据体 .</p>
</li>
<li><p>利用 URLConnection 发送网络请求(发送请求并获得结果) ;</p>
</li>
</ol>
<p>NSURLConnection提供了两个静态方法可以直接以同步或异步的方式向服务器发送网络请求.   	</p>
<pre><code>同步请求:
sendSynchronousRequest : returningResponse : error :

异步请求:
sendAsynchronousRequest : queue : completionHandler :
</code></pre>
<p>在网络请求过程中, 接收数据的过程实际上是通过 NSURLConnectionDataDelegate来实现的, 常用代理方法包括:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器开始返回数据</span></span><br><span class="line">- (<span class="type">void</span>)connection:didReceiveResponse:</span><br><span class="line"><span class="comment">// 收到服务器返回的数据，本方法会被调用多次</span></span><br><span class="line">- (<span class="type">void</span>)connection:didReceiveData:</span><br><span class="line"><span class="comment">// 数据接收完毕，做数据的最后处理</span></span><br><span class="line">- (<span class="type">void</span>)connectionDidFinishLoading:</span><br><span class="line"><span class="comment">// 网络连接错误</span></span><br><span class="line">- (<span class="type">void</span>)connection:didFailWithError:</span><br></pre></td></tr></table></figure>

<p>备注：欢迎转载，但请一定注明出处！ <a href="http://blog.wangruofeng007.com/">http://blog.wangruofeng007.com</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-http-post-and-multipart-forms/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-http-post-and-multipart-forms/" class="post-title-link" itemprop="url">HTTP POST and multipart forms</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 05:45:41" itemprop="dateCreated datePublished" datetime="2016-01-13T05:45:41+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 11:36:52" itemprop="dateModified" datetime="2024-11-02T11:36:52+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>438</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="HTTP-POST使用注意事项："><a href="#HTTP-POST使用注意事项：" class="headerlink" title="HTTP POST使用注意事项："></a><code>HTTP POST</code>使用注意事项：</h4><ul>
<li><p>http Body 中的NSData 编码方式要用<code>NSASCIIStringEncoding</code>而不是<code>NSUTF8StringEncoding</code></p>
</li>
<li><p>通过</p>
<p>  <code>NSString *postLength = [NSString stringWithFormat:@&quot;%d&quot;,[postData length]];</code></p>
</li>
</ul>
<p>		<br>计算数据的长度</p>
<h4 id="POST参数设置"><a href="#POST参数设置" class="headerlink" title="POST参数设置"></a>POST参数设置</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置header Content-Length</span></span><br><span class="line">[request setValue:postLength forHTTPHeaderField:<span class="string">@&quot;Content-Length&quot;</span>];</span><br><span class="line"><span class="comment">//设置header contentType</span></span><br><span class="line">[request setValue:<span class="string">@&quot;application/x-www-form-urlencoded&quot;</span> forHTTPHeaderField:<span class="string">@&quot;Current-Type&quot;</span>];</span><br><span class="line"><span class="comment">//设置body</span></span><br><span class="line">[request setHTTPBody:postData];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注:普通<code>post</code>的<code>header</code>的<code>Current-Type</code>为<code>application/x-www-form-urlencoded</code></p>
</blockquote>
<h4 id="Multipart-Forms-POST参数设置"><a href="#Multipart-Forms-POST参数设置" class="headerlink" title="Multipart Forms POST参数设置"></a>Multipart Forms POST参数设置</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置header contentType</span></span><br><span class="line"><span class="built_in">NSString</span> *contentType = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;multipart/form-data; boundary=%@&quot;</span>, boundary];</span><br><span class="line">[request addValue:contentType forHTTPHeaderField:<span class="string">@&quot;Content-Type&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置body contentType</span></span><br><span class="line">[body appendData:[<span class="string">@&quot;Content-Type: application/octet-stream\r\n\r\n&quot;</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注:<code>Multipart Forms</code>的<code>header</code>的<code>Current-Type</code>为<code>multipart/form-data</code></p>
</blockquote>
<p>request body like this</p>
<pre><code>    --YOUR_BOUNDARY_STRING
    Content-Disposition: form-data; name=&quot;photo&quot;; filename=&quot;calm.jpg&quot;
    Content-Type: image/jpeg

    YOUR_IMAGE_DATA_GOES_HERE
    --YOUR_BOUNDARY_STRING
    Content-Disposition: form-data; name=&quot;message&quot;

    My first message
    --YOUR_BOUNDARY_STRING
    Content-Disposition: form-data; name=&quot;user&quot;

    1
    --YOUR_BOUNDARY_STRING
</code></pre>
<p>I’m sending over three variables: an image named photo, a string named message, and an integer named user. It’s important to note the linebreaks and the dashes before the boundary string. These must be included in order to build a good request. Now lets write some objective-c:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *boundary = <span class="string">@&quot;YOUR_BOUNDARY_STRING&quot;</span>;</span><br><span class="line"><span class="built_in">NSString</span> *contentType = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;multipart/form-data; boundary=%@&quot;</span>, boundary];</span><br><span class="line">[request addValue:contentType forHTTPHeaderField:<span class="string">@&quot;Content-Type&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableData</span> *body = [<span class="built_in">NSMutableData</span> data];</span><br><span class="line"></span><br><span class="line">[body appendData:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;\r\n--%@\r\n&quot;</span>, boundary] dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line">[body appendData:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;Content-Disposition: form-data; name=\&quot;photo\&quot;; filename=\&quot;%@.jpg\&quot;\r\n&quot;</span>, <span class="keyword">self</span>.message.photoKey] dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line">[body appendData:[<span class="string">@&quot;Content-Type: application/octet-stream\r\n\r\n&quot;</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line">[body appendData:[<span class="built_in">NSData</span> dataWithData:imageData]];</span><br><span class="line"></span><br><span class="line">[body appendData:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;\r\n--%@\r\n&quot;</span>, boundary] dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line">[body appendData:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;Content-Disposition: form-data; name=\&quot;message\&quot;\r\n\r\n%@&quot;</span>, <span class="keyword">self</span>.message.message] dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"></span><br><span class="line">[body appendData:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;\r\n--%@\r\n&quot;</span>, boundary] dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line">[body appendData:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;Content-Disposition: form-data; name=\&quot;user\&quot;\r\n\r\n%d&quot;</span>, <span class="number">1</span>] dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"></span><br><span class="line">[body appendData:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;\r\n--%@\r\n&quot;</span>, boundary] dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"></span><br><span class="line">[request setHTTPBody:body];</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>Now all we need to do is make a connection to the server and send the request:</p>
<pre><code>[request setHTTPBody:body];
</code></pre>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURLResponse</span> *response;</span><br><span class="line"><span class="built_in">NSError</span> *error;</span><br><span class="line"></span><br><span class="line">[<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request returningResponse:&amp;response error:&amp;error];</span><br></pre></td></tr></table></figure>

<p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://nthn.me/posts/2012/objc-multipart-forms.html">Sending Multipart Forms with Objective-C</a></li>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/24250475/post-multipart-form-data-with-objective-c">POST multipart&#x2F;form-data with Objective-C</a></li>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/15749486/sending-an-http-post-request-on-ios">Sending an HTTP POST request on iOS</a></li>
<li><a target="_blank" rel="noopener" href="http://www.w3.org/Protocols/rfc1341/7_2_Multipart.html">The Multipart Content-Type–w3规范</a></li>
</ul>
<p>备注：欢迎转载，但请一定注明出处！ <a href="http://blog.wangruofeng007.com/">http://blog.wangruofeng007.com</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-gong-han-mo-shi-xiang-jie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-gong-han-mo-shi-xiang-jie/" class="post-title-link" itemprop="url">工厂模式详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 05:39:21" itemprop="dateCreated datePublished" datetime="2016-01-13T05:39:21+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 11:36:52" itemprop="dateModified" datetime="2024-11-02T11:36:52+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="3种工厂模式"><a href="#3种工厂模式" class="headerlink" title="3种工厂模式"></a>3种工厂模式</h2><p>概述：工厂模式是个系列，分为简单工厂模式， 工厂方法模式， 抽象工厂模式，这三种模式也非常常用。这些模式最最经典的就例子就是设计计算器。</p>
<ul>
<li>Factory Method (工厂方法模式)</li>
<li>Abstract Factory (抽象工厂模式）</li>
<li>Simple Factory（简单工厂模式）</li>
</ul>
<p><code>参考GoF《Design Patterns》一书</code></p>
<p>GOF是这样描述工厂模式的：</p>
<blockquote>
<p>“Define an interface for creating an object, but let subclasses decide which class to instantiate. Factory Method lets a class defer instantiation to subclasses.”</p>
</blockquote>
<blockquote>
<p>在基类中定义创建对象的一个接口，让子类决定实例化哪个类。工厂方法让一个类的实例化延迟到子类中进行。</p>
</blockquote>
<h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><p>  严格的说，简单工厂模式并不是23种常用的设计模式之一，它只算工厂模式的一个特殊实现。简单工厂模式在实际中的应用相对于其他2个工厂模式用的还是相对少得多，因为它只适应很多简单的情况，最最重要的是它违背了我们在概述中说的开放-封闭原则。因为每次你要新添加一个功能，都需要在生switch-case 语句（或者if-else 语句）中去修改代码，添加分支条件</p>
<p>  简单工厂模式角色分配：</p>
<ol>
<li><p>Creator（产品创建者）<br>简单工厂模式的核心，它负责实现创建所有实例的内部逻辑。工厂类可以被外界直接调用，创建所需的产品对象。</p>
</li>
<li><p>Product （ 产品抽象类）<br>简单工厂模式所创建的所有对象的父类，它负责描述所有实例所共有的公共接口。</p>
</li>
<li><p>Concrete Product （具体产品）<br>是简单工厂模式的创建目标，所有创建的对象都是充当这个角色的某个具体类的实例。</p>
</li>
</ol>
<p>简单的工厂模式UML图<br><img src="http://ww1.sinaimg.cn/mw690/64124373gw1ezgte12komj20h109smxx.jpg" alt="简单工厂模式"></p>
<p>考虑下面一个事例： 加入你是一个商人，你做的的是手机生意。现在你生产android 手机和iphone等，考虑到以后你可能还会生产其他手机例如ubuntu手机。假定你选择了简单工厂模式来实现。那么显然，我们需要所有产品的抽象基类（Product） 即是Phone类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span>   </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual ~Phone()&#123;&#125;;<span class="comment">//在删除的时候防止内存泄露  </span></span><br><span class="line">    virtual <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span> = <span class="number">0</span>;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后我们需要具体的产品类 Concrete Product： AndroidPhone 和iOSPhone</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AndroidPhone</span> : <span class="keyword">public</span> Phone   </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span>&#123; cout&lt;&lt;<span class="string">&quot;AndroidPhone is calling...&quot;</span>&lt;&lt;endl;&#125;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IosPhone</span> : <span class="keyword">public</span> Phone  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span> &#123; cout&lt;&lt;<span class="string">&quot;IosPhone is calling...&quot;</span>&lt;&lt;endl;&#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>最后我们需要Creator</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhoneFactory</span>  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    Phone* createPhone(string phoneName)  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">if</span>(phoneName == <span class="string">&quot;AndroidPhone&quot;</span>)  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AndroidPhone</span>();  </span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(phoneName == <span class="string">&quot;IosPhone&quot;</span>)  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IosPhone</span>();  </span><br><span class="line">        &#125;  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> NULL;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>客户端这样实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    PhoneFactor factory;  </span><br><span class="line">    Phone* myAndroid = factory.createPhone(<span class="string">&quot;AndroidPhone&quot;</span>);  </span><br><span class="line">    Phone* myIPhone = factory.createPhone(<span class="string">&quot;iOSPhone&quot;</span>);  </span><br><span class="line">    <span class="keyword">if</span>(myAndroid)  </span><br><span class="line">    &#123;  </span><br><span class="line">        myAndroid-&gt;call(<span class="string">&quot;123&quot;</span>);  </span><br><span class="line">        delete myAndroid;  </span><br><span class="line">        myAndroid = NULL;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(myIPhone)  </span><br><span class="line">    &#123;  </span><br><span class="line">        myIPhone-&gt;call(<span class="string">&quot;123&quot;</span>);  </span><br><span class="line">        delete  myIPhone;  </span><br><span class="line">        myIPhone = NULL;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这就是简单工厂方法，把所有的创建交给creator,creator 通过switch-case(或者if-else)语句来选择具体创建的对象。简单明了。但是就如上面所说，它最致命的问题的违背了开放-封闭原则。每次你要新添加一个功能，都要修改factor里面的createPhone代码。 但是工厂方法模式可以解决这个问题。</p>
<h3 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3><p>个人觉得工厂方法模式在工厂模式家族中是用的最多模式。上面说过了，如果简单工厂模式，要添加一个新功能，比如我现在要增加WinPhone 的生产，那么我要修改PhoneFactory中的createPhone 中的分支判断条件。这违背了开放-封闭原则，那为什么不能将创建方法放到子类中呢？<br>工厂方法的定义就是：定义一个用于创建对象的接口，让子类决定实例化哪一个类，工厂方法使一个类的实例化延迟到其子类。</p>
<p>  工厂方法模式角色：</p>
<ol>
<li>抽象工厂(Creator)角色：是工厂方法模式的核心，与应用程序无关。任何在模式中创建的对象的工厂类必须实现这个接口。</li>
<li>具体工厂(Concrete Creator)角色：这是实现抽象工厂接口的具体工厂类，包含与应用程序密切相关的逻辑，并且受到应用程序调用以创建产品对象。</li>
<li>抽象产品(Product)角色：工厂方法模式所创建的对象的超类型，也就是产品对象的共同父类或共同拥有的接口。</li>
<li>具体产品(Concrete Product)角色：这个角色实现了抽象产品角色所定义的接口。某具体产品有专门的具体工厂创建，它们之间往往一一对应</li>
</ol>
<p>工厂方法模式UML图：<br><img src="http://ww1.sinaimg.cn/mw690/64124373gw1ezgtqlod9zj20hy0aijrz.jpg" alt="工厂方法模式"></p>
<p>看定义看的晕乎乎的？那么我们来看代码：产品接口，以及其相应的子类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span>   </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual ~Phone()&#123;&#125;;<span class="comment">//在删除的时候防止内存泄露  </span></span><br><span class="line">    virtual <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span> = <span class="number">0</span>;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndroidPhone</span> : <span class="keyword">public</span> Phone   </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span>&#123; cout&lt;&lt;<span class="string">&quot;AndroidPhone is calling...&quot;</span>&lt;&lt;endl;&#125;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">iOSPhone</span> : <span class="keyword">public</span> Phone  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span> &#123; cout&lt;&lt;<span class="string">&quot;iOSPhone is calling...&quot;</span>&lt;&lt;endl;&#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>上面这个和简单工厂方法还是一样的。接下来不一样的来了…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhoneFactory</span>  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual ~PhoneFactory()&#123;&#125;;  </span><br><span class="line">    virtual Phone* createPhone() = <span class="number">0</span>;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndroidPhoneFactory</span> : <span class="keyword">public</span> PhoneFactory  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual Phone* createPhone()  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AndroidPhone</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IosPhoneFactory</span> : <span class="keyword">public</span> PhoneFactory  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual Phone* createPhone()  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IosPhone</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>工厂方法将PhoneFactory抽象成了基类，PhoneFactory的createPhone不在像以前那样将所有的判断塞到里面。而是改由其子类来实现创建功能，这感觉就是权力下放。<br>客户端：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    PhoneFactory*  androidCreator = <span class="keyword">new</span> <span class="title class_">AndroidPhoneFactory</span>();  </span><br><span class="line">    PhoneFactory*  iosCreator = <span class="keyword">new</span> <span class="title class_">IosPhoneFactory</span>();  </span><br><span class="line">    Phone*  myAndroid = androidCreator-&gt;createPhone();  </span><br><span class="line">    Phone* myIPhone = iosCreator-&gt;createPhone();  </span><br><span class="line">    <span class="keyword">if</span>(myAndroid)  </span><br><span class="line">    &#123;  </span><br><span class="line">        myAndroid-&gt;call(<span class="string">&quot;123&quot;</span>);  </span><br><span class="line">        delete myAndroid;  </span><br><span class="line">        myAndroid = NULL;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(myIPhone)  </span><br><span class="line">    &#123;  </span><br><span class="line">        myIPhone-&gt;call(<span class="string">&quot;123&quot;</span>);  </span><br><span class="line">        delete  myIPhone;  </span><br><span class="line">        myIPhone = NULL;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    delete androidCreator;  </span><br><span class="line">    delete iosCreator;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在工厂方法模式中，核心工厂类不在负责产品的创建，而是将具体的创建工作交给子类去完成。也就是后所这个核心工厂仅仅只是提供创建的接口，具体实现方法交给继承它的子类去完成。当我们的系统需要增加其他新功能时，只需要继承PhoneFactory这个类，并且实现createPhone接口。 不需要对原工厂PhoneFactory进行任何修改，这样很好地符合了“开放-封闭“原则。</p>
<p>虽然工厂方法模式满足了”开放-封闭”原则，但是这个模式也仍然有缺点：每次增加一个产品时，都需要增加一个具体类和对象实现工厂，是的系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。这并不是什么好事。</p>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><p>在工厂方法模式中，其实我们有一个潜在意识的意识。那就是我们生产的都是同一类产品，例如我们生产的都是手机！那么现在假如现在我们又要生产平板了了呢？那么就要用到抽象工厂模式。我抽象工厂模式也用的比较多在工厂模式家族中，仅次于工厂方法模式。在了解抽象工厂模式之前，还是老生常谈的理清下产品等级结构和产品簇的概念。下面的图还是老图。但是我讲讲我的理解：</p>
<p><img src="http://ww2.sinaimg.cn/mw690/64124373gw1ezgtxoyognj20d8087wes.jpg" alt="抽象工厂模式"><br>产品等级结构：产品的等级结构也就是产品的继承结构。我理解就是同一类产品，比如手机是一个系列，有android手机，ios手机，win手机，那么这个抽象类手机和他的子类就构成了一个产品等级结构。那其他的平板显然不是和手机一个系列的，一个平板，一个是手机，所以他们是不同的产品等级结构。</p>
<p>产品族: 在抽象工厂模式中，产品族是指由同一个工厂生产的，位于不同产品等级结构中的一组产品。比如分为android产品，和ios产品。其中一个ios产品包含ios手机和ios平板。显然ios手机和ios平板不是同一个产品等级结构的，因为一个是手机，一个是平板。但他们是同一个产品簇—都是ios产品。<br>希望大家通过上面的例子大家明白了这两个概念。</p>
<p> 抽象工厂模式的UML图：<br> <img src="http://ww4.sinaimg.cn/mw690/64124373gw1ezgtzs7hwaj20db09p0ta.jpg" alt="抽象工厂模式"></p>
<p>接着上面的话题，现在假如我要增加对平板的支持，那么我们肯定先添加两个产品等级结构，一个是手机，一个是平板：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//产品等级结构--手机  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span>   </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual ~Phone()&#123;&#125;;<span class="comment">//在删除的时候防止内存泄露  </span></span><br><span class="line">    virtual <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span> = <span class="number">0</span>;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndroidPhone</span> : <span class="keyword">public</span> Phone   </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span>&#123; cout&lt;&lt;<span class="string">&quot;AndroidPhone is calling...&quot;</span>&lt;&lt;endl; &#125;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IosPhone</span> : <span class="keyword">public</span> Phone  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(string number)</span> &#123; cout&lt;&lt;<span class="string">&quot;IosPhone is calling...&quot;</span>&lt;&lt;endl; &#125;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//产品等级结构--平板  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pad</span>  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual ~Pad()&#123;&#125;;  </span><br><span class="line">    virtual <span class="keyword">void</span> <span class="title function_">playMovie</span><span class="params">()</span> = <span class="number">0</span>;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndroidPad</span> : <span class="keyword">public</span> Pad  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual <span class="keyword">void</span> <span class="title function_">playMovie</span><span class="params">()</span>&#123; cout&lt;&lt;<span class="string">&quot;AndriodPad is playing movie...&quot;</span>&lt;&lt;endl; &#125;  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IosPad</span> : <span class="keyword">public</span> Pad  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual <span class="keyword">void</span> <span class="title function_">playMovie</span><span class="params">()</span>&#123; cout&lt;&lt;<span class="string">&quot;IosPad is playing movie...&quot;</span>&lt;&lt;endl; &#125;  </span><br><span class="line">&#125;;  </span><br></pre></td></tr></table></figure>
<p>然后具体的工厂我们整个工厂是生产移动设备的所以我们取名为MobileFactory,然后工厂可以生产平板和手机，故有了createPhone 和createPad两个接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MobileFactory</span>  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    virtual ~MobileFactory()&#123;&#125;;  </span><br><span class="line">    virtual Phone* createPhone() = <span class="number">0</span>;  </span><br><span class="line">    virtual Pad* createPad() = <span class="number">0</span>;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>接着是 android 产品簇 的工厂类，负责生产android 的手机和平板：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AndroidFactory</span> : <span class="keyword">public</span> MobileFactory  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    Phone* createPhone()  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AndroidPhone</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">    Pad* createPad()  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AndroidPad</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接着是ios的产品簇的工厂类，负责生产ios的手机和平板：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">IosFactory</span> : <span class="keyword">public</span> MobileFactory  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">    Phone* createPhone()  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IosPhone</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    Pad* createPad()  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IosPad</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>最后客户端这样实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    MobileFactory*  androidCreator = <span class="keyword">new</span> <span class="title class_">AndroidFactory</span>();  </span><br><span class="line">    MobileFactory*  iosCreator = <span class="keyword">new</span> <span class="title class_">IosFactory</span>();  </span><br><span class="line">    Phone*  myAndroidPhone = androidCreator-&gt;createPhone();  </span><br><span class="line">    Pad* myAndroidPad = androidCreator-&gt;createPad();  </span><br><span class="line">    Phone* myIosPhone = iosCreator-&gt;createPhone();  </span><br><span class="line">    Pad* myIosPad = iosCreator-&gt;createPad();  </span><br><span class="line"></span><br><span class="line">    myAndroidPhone-&gt;call(<span class="string">&quot;123&quot;</span>);  </span><br><span class="line">    myAndroidPad-&gt;playMovie();  </span><br><span class="line"></span><br><span class="line">    myIosPhone-&gt;call(<span class="string">&quot;123&quot;</span>);  </span><br><span class="line">    myIosPad-&gt;playMovie();  </span><br><span class="line">    <span class="comment">//这里没有做释放和判断，请自己判断和释放  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：<br>抽象工厂模式适用于那些有多种产品的产品簇，并且每次使用其中的某一产品簇的产品。<br>缺点 ： 抽象工厂模式的添加新功能也非常麻烦，比工厂方法模式都还要复杂的多。<br>优点： 当一个产品族中的多个对象被设计成一起工作时，它能够保证客户端始终只使用同一个产品族中的对象</p>
<h2 id="主要用途"><a href="#主要用途" class="headerlink" title="主要用途"></a>主要用途</h2><p>工厂方法要解决的问题是对象的创建时机，它提供了一种扩展的策略，很好地符合了开放封闭原则。工厂方法也叫做虚构造器（Virtual Constructor）。</p>
<p><img src="http://cdn.cocimg.com/cms/uploads/allimg/130516/4196_130516112054_1.png" alt="工厂方法的类结构图"></p>
<h2 id="什么时候使用工厂方法"><a href="#什么时候使用工厂方法" class="headerlink" title="什么时候使用工厂方法"></a>什么时候使用工厂方法</h2><p>当是如下情况是，可以使用工厂方法：一个类不知道它所必须创建的对象的类时，一个类希望有它的子类决定所创建的对象时。</p>
<p>更多关于工厂方法的介绍，可以参考本文最后给出的参考内容。下面我们就来看看在iOS中工厂方法的一种实现方法。</p>
<h2 id="iOS中工厂方法的实现实例"><a href="#iOS中工厂方法的实现实例" class="headerlink" title="iOS中工厂方法的实现实例"></a>iOS中工厂方法的实现实例</h2><p>如下有一个类图，该图描述了下面即将实现的工厂方法（利用工厂方法，创建出不同的形状）。其中BVShapeFactory为工厂方法的基类，BVShape为形状的基类，BVClient通过BVShapeFactory，利用 BVShapeFactory的子类（BVCircleShapeFactory和BVSquareShapeFactory）分别创建出BVCircleShape和BVSquareShape。<br><img src="http://cdn.cocimg.com/cms/uploads/allimg/130516/4196_130516112123_1.png" alt="工厂方法"></p>
<p>github下载地址:<a target="_blank" rel="noopener" href="https://github.com/BeyondVincent/ios_patterns/tree/master/FactoryMethodPattern">https://github.com/BeyondVincent/ios_patterns/tree/master/FactoryMethodPattern</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="http://doc.okbase.net/luozhonglan/archive/103843.html">iOS设计模式——工厂方法（简单工厂模式，工厂方法模式， 抽象工厂模式）</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cocoachina.com/ios/20130516/6219.html">iOS设计模式(03):工厂方法</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cocoachina.com/ios/20141124/10296.html">Objective-C类族和工厂模式</a></li>
<li><a target="_blank" rel="noopener" href="http://crosbymichael.com/objective-c-design-patterns-factory.html">Objective C Design Patterns - Factory</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/ios/documentation/General/Conceptual/CocoaEncyclopedia/ClassFactoryMethods/ClassFactoryMethods.html">Class Factory Methods</a>–Apple</li>
<li><a target="_blank" rel="noopener" href="http://www.raywenderlich.com/46988/ios-design-patterns">iOS Design Patterns</a>–raywenderlich</li>
<li><a target="_blank" rel="noopener" href="http://www.knowstack.com/abstract-factory-design-pattern-objective-c/">Abstract Factory Design Pattern Objective C</a></li>
<li><a target="_blank" rel="noopener" href="https://www.binpress.com/tutorial/the-factory-design-pattern-explained-by-example/142">The factory design pattern explained by example</a>-php</li>
<li><a target="_blank" rel="noopener" href="https://www.safaribooksonline.com/blog/2014/12/10/design-patterns-series-day-3-factory-singleton-patterns/">Design Patterns Series, Day 3: Factory and Singleton Patterns</a>–safaribooksonline</li>
<li><a target="_blank" rel="noopener" href="http://www.bobmccune.com/2011/04/08/automagic-factories-in-objective-c/">Automagic Factories in Objective-C</a>–bobmccune</li>
</ul>
<p>备注：欢迎转载，但请一定注明出处！ <a href="http://blog.wangruofeng007.com/">http://blog.wangruofeng007.com</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-duo-xian-cheng-zhi-nsthread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-duo-xian-cheng-zhi-nsthread/" class="post-title-link" itemprop="url">多线程之 NSThread</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 05:36:48" itemprop="dateCreated datePublished" datetime="2016-01-13T05:36:48+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 16:28:12" itemprop="dateModified" datetime="2024-11-02T16:28:12+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>966</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="本文目录"><a href="#本文目录" class="headerlink" title="本文目录"></a>本文目录</h2><ul>
<li>前言</li>
<li>1.获取当前线程</li>
<li>2.获取主线程</li>
<li>3.NSThread的创建</li>
<li>4.暂停当前线程</li>
<li>5.线程的其他操作</li>
<li>6.优缺点</li>
</ul>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>每个iOS应用程序都有个专门用来更新显示UI界面、处理用户触摸事件的主线程，因此不能将其他太耗时的操作放在主线程中执行，不然会造成主线程堵塞(出现卡机现象)，带来极坏的用户体验。一般的解决方案就是将那些耗时的操作放到另外一个线程中去执行，多线程编程是防止主线程堵塞，增加运行效率的最佳方法。</p>
<p>iOS中有3种常见的多线程编程方法</p>
<ol>
<li><p><code>NSThread</code><br>这种方法需要管理线程的生命周期、同步、加锁问题，会导致一定的性能开销</p>
</li>
<li><p><code>NSOperation</code>和<code>NSOperationQueue</code><br>是基于OC实现的。NSOperation以面向对象的方式封装了需要执行的操作，然后可以将这个操作放到一个NSOperationQueue中去异步执行。不必关心线程管理、同步等问题。</p>
</li>
<li><p><code>Grand Centeral Dispatch</code><br>简称GCD，iOS4才开始支持，是纯C语言的API。自iPad2开始，苹果设备开始有了双核CPU，为了充分利用这2个核，GCD提供了一些新特性来支持多核并行编程</p>
</li>
</ol>
<p>这篇文章简单介绍<code>NSThread这</code>个类，一个<code>NSThread</code>实例就代表着一条线程</p>
<h3 id="1-获取当前线程"><a href="#1-获取当前线程" class="headerlink" title="1.获取当前线程"></a>1.获取当前线程</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSThread</span> *current = [<span class="built_in">NSThread</span> currentThread];</span><br></pre></td></tr></table></figure>

<h3 id="2-获取主线程"><a href="#2-获取主线程" class="headerlink" title="2.获取主线程"></a>2.获取主线程</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSThread</span> *main = [<span class="built_in">NSThread</span> mainThread];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;主线程:%@&quot;</span>, main);    </span><br></pre></td></tr></table></figure>

<p>打印结果是：</p>
<pre><code>2013-04-18 21:36:38.599 thread[7499:c07] 主线程:&lt;NSThread: 0x71434e0&gt;&#123;name = (null), num = 1&#125;
</code></pre>
<p>num相当于线程的id，主线程的num是为1的</p>
<h3 id="3-NSThread的创建"><a href="#3-NSThread的创建" class="headerlink" title="3.NSThread的创建"></a>3.NSThread的创建</h3><h4 id="a-动态方法"><a href="#a-动态方法" class="headerlink" title="a.动态方法"></a>a.动态方法</h4><pre><code>- (id)initWithTarget:(id)target selector:(SEL)selector object:(id)argument;
</code></pre>
<p>在第2行创建了一条新线程，然后在第4行调用<code>start</code>方法启动线程，线程启动后会调用self的<code>run:</code>方法，并且将@”mj”作为方法参数</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化线程</span></span><br><span class="line"><span class="built_in">NSThread</span> *thread = [[[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run:) object:<span class="string">@&quot;mj&quot;</span>] autorelease];</span><br><span class="line"><span class="comment">// 开启线程</span></span><br><span class="line">[thread start];</span><br></pre></td></tr></table></figure>

<p>假如run:方法是这样的：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)run:(<span class="built_in">NSString</span> *)string &#123;</span><br><span class="line">     <span class="built_in">NSThread</span> *current = [<span class="built_in">NSThread</span> currentThread];</span><br><span class="line">     <span class="built_in">NSLog</span>(<span class="string">@&quot;执行了run:方法-参数：%@，当前线程：%@&quot;</span>, string, current);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印结果为：</p>
<pre><code>2013-04-18 21:40:33.102 thread[7542:3e13] 执行了run:方法-参数：mj，当前线程：&lt;NSThread: 0x889e8d0&gt;&#123;name = (null), num = 3&#125;
</code></pre>
<p>可以发现，这条线程的num值为3，说明不是主线程，主线程的num为1</p>
<h4 id="b-静态方法"><a href="#b-静态方法" class="headerlink" title="b.静态方法"></a>b.静态方法</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="type">void</span>)detachNewThreadSelector:(SEL)selector toTarget:(<span class="type">id</span>)target withObject:(<span class="type">id</span>)argument;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(run:) toTarget:<span class="keyword">self</span> withObject:<span class="string">@&quot;mj&quot;</span>];</span><br></pre></td></tr></table></figure>

<h4 id="c-隐式创建线程"><a href="#c-隐式创建线程" class="headerlink" title="c.隐式创建线程"></a>c.隐式创建线程</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(run:) withObject:<span class="string">@&quot;mj&quot;</span>];</span><br></pre></td></tr></table></figure>
<p>会隐式地创建一条新线程，并且在这条线程上调用self的run:方法，以@”mj”为方法参数</p>
<h3 id="4-暂停当前线程"><a href="#4-暂停当前线程" class="headerlink" title="4.暂停当前线程"></a>4.暂停当前线程</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSDate</span> *date = [<span class="built_in">NSDate</span> dateWithTimeInterval:<span class="number">2</span> sinceDate:[<span class="built_in">NSDate</span> date]];  </span><br><span class="line">[<span class="built_in">NSThread</span> sleepUntilDate:date];</span><br></pre></td></tr></table></figure>

<p>上面两种做法都是暂停当前线程2秒</p>
<h3 id="5-线程的其他操作"><a href="#5-线程的其他操作" class="headerlink" title="5.线程的其他操作"></a>5.线程的其他操作</h3><h4 id="a-在指定线程上执行操作"><a href="#a-在指定线程上执行操作" class="headerlink" title="a.在指定线程上执行操作"></a>a.在指定线程上执行操作</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>

<ul>
<li>上面代码的意思是在thread这条线程上调用self的run方法</li>
<li>最后的YES代表：上面的代码会阻塞，等run方法在thread线程执行完毕后，上面的代码才会通过</li>
</ul>
<h4 id="b-在主线程上执行操作"><a href="#b-在主线程上执行操作" class="headerlink" title="b.在主线程上执行操作"></a>b.在主线程上执行操作</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];  </span><br></pre></td></tr></table></figure>

<p>在主线程调用self的run方法</p>
<h4 id="c-在当前线程执行操作"><a href="#c-在当前线程执行操作" class="headerlink" title="c.在当前线程执行操作"></a>c.在当前线程执行操作</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>在当前线程调用self的run方法</p>
<h3 id="6-优缺点"><a href="#6-优缺点" class="headerlink" title="6.优缺点"></a>6.优缺点</h3><ol>
<li>优点：<code>NSThread</code>比其他多线程方案较轻量级，更直观地控制线程对象</li>
<li>缺点：需要自己管理线程的生命周期，线程同步。线程同步对数据的加锁会有一定的系统开销</li>
</ol>
<p>备注：欢迎转载，但请一定注明出处！ <a href="http://blog.wangruofeng007.com/">http://blog.wangruofeng007.com</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.wangruofeng007.com/2016/01/13/2016-01-13-nsoperation-and-nsoperationqueue-tutorial-in-swift/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王若风">
      <meta itemprop="description" content="王若风的技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王若风的技术博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/13/2016-01-13-nsoperation-and-nsoperationqueue-tutorial-in-swift/" class="post-title-link" itemprop="url">NSOperation and NSOperationQueue Tutorial in Swift</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-01-13 05:18:36" itemprop="dateCreated datePublished" datetime="2016-01-13T05:18:36+08:00">2016-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-02 11:36:52" itemprop="dateModified" datetime="2024-11-02T11:36:52+08:00">2024-11-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>24 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>译自 Written by <a target="_blank" rel="noopener" href="http://www.raywenderlich.com/u/jrturton"> Richard Turton</a> — on October 7, 2014</li>
<li>原文链接：<a target="_blank" rel="noopener" href="http://www.raywenderlich.com/76341/use-nsoperation-nsoperationqueue-swift">http://www.raywenderlich.com/76341/use-nsoperation-nsoperationqueue-swift</a></li>
<li>译者<a target="_blank" rel="noopener" href="https://twitter.com/oneruofeng">@oneruofeng</a></li>
</ul>
<p><strong>Post info</strong>: Updated for Xcode 7.1 and Swift 2.1 – 1 January 2016</p>
<p><strong>Update note</strong>: This tutorial was updated to iOS 8, Xcode 6.1 and Swift by Richard Turton.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.raywenderlich.com/76341/use-nsoperation-nsoperationqueue-swift">Original post</a> by Tutorial Team member <a target="_blank" rel="noopener" href="http://www.raywenderlich.com/u/Canopus">Soheil Azarpour</a>.</p>
</blockquote>
<p>每个人都有点击一个按钮或者进入一些文本在iOS或者Mac App上的令人沮丧的经历，就是突然-WHAM，用户交互停止了响应。</p>
<p>在Mac上，你的用户开始盯着一个沙漏或者一个七彩的轮子开始旋转直到它们再次恢复UI交互为止。在一个iOS app中，用户期望App立即响应它们的触摸事件，无响应的app给人的感觉是笨重和缓慢，这样通常会导致收到差评。</p>
<p>保持你的app的可交互的状态说起来容易做起来难，一旦你的app需要执行不仅仅是少量的任务，事情很快就变得很复杂，我们并没有多少事件在主事件循环执行繁重的工作并且同时提供一个可以响应的UI。</p>
<p>低级的开发者是怎样做的呢？解决方案就是把工作从主线程中移除通过并发。并发意味着你应用所有的操作同时执行在多个流（或者线程）中–这样的话用户界面就能保持响应的要执行的工作。</p>
<p>一种实现并发操作在iOS是通过<code>NSOperation</code>和<code>NSOperationQueue</code>这两个类。在这个教程中，你将学会怎样使用它们！你将从一个没有使用并发的App开始，所以它将出现的非常迟钝和无响应。然后你将重做你的应用给它们添加并发操作并且–希望–呈现一个更加响应良好的可交互界面给用户！</p>
<h3 id="我们开始吧"><a href="#我们开始吧" class="headerlink" title="我们开始吧"></a>我们开始吧</h3><p>这份样品工程的总的目标的就是展示一个滤镜处理过的图片的表视图。图片将从网络上下载，经过一个滤镜处理后，然后在表视图中显示。</p>
<p>下面是这个app模型的示意图</p>
<p><img src="http://ww2.sinaimg.cn/mw690/64124373gw1ezk3rh3ebyj20i20nmq4k.jpg" alt="app模型的示意图"></p>
<!--
<img src = "http://ww2.sinaimg.cn/mw690/64124373gw1ezk3rh3ebyj20i20nmq4k.jpg" with= 300 height = 600>-->


<h3 id="第一个版本尝试"><a href="#第一个版本尝试" class="headerlink" title="第一个版本尝试"></a>第一个版本尝试</h3><p>下载你将在这个教程中使用的<a target="_blank" rel="noopener" href="http://cdn5.raywenderlich.com/wp-content/uploads/2014/10/ClassicPhotos-Starter63.zip">第一个版本的项目</a></p>
<blockquote>
<p>注意：所以的图片来自<a target="_blank" rel="noopener" href="http://sxc.hu/"> stock.xchng.</a>。一下图片在数据源故意错误命名，以便这里有些例子是图片下载失败好处理失败的情况。</p>
</blockquote>
<p>构建并且运行这个工程，最终你将看到这个app运行起来显示一列照片。尝试滚动这个列表，很痛苦，不是吗？<br><img src="http://ww3.sinaimg.cn/mw690/64124373gw1ezk45qmdigj205x08wdga.jpg" alt="list of photoes"></p>
<p><em>传统的相册，运行缓慢</em></p>
<p>所有的操作都发生在<code>ListViewController.swift</code>里，并且最主要的是发生在<code> tableView(_:cellForRowAtIndexPath:)</code>方法里。看一下那个方法和注释这里有两件相当集中的事情需要思考：</p>
<ol>
<li><code>从网络载入图片数据</code>。即使网络状况良好，app将仍然必须等待直到下载完成了才能继续。</li>
<li>使用<em>Core Image</em>给图片加滤镜。这个方法给图片应用一个深褐色的滤镜，假如你想了解更多关于<code>Core Image</code>滤镜的知识，请点击<a target="_blank" rel="noopener" href="http://www.raywenderlich.com/76285/beginning-core-image-swift">Beginning Core Image in Swift</a></li>
</ol>
<p>还有，你将载入一系列图片请求从网络当它第一次被请求时:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lazy</span> <span class="keyword">var</span> photos <span class="operator">=</span> <span class="type">NSDictionary</span>(contentsOfURL:dataSourceURL)</span><br></pre></td></tr></table></figure>

<p>所有的工作发生在应用的主线程。由于主线程也负责用户交互，让它一直忙于从网络下载东西和给图片加滤镜消磨掉了响应中的app。你可以通过使用Xcode的仪表测量视图获得这样一个快速的概述。你可以通过显示<code>调试导航</code>(Commnad+6)接入这个仪表视图,让后选择<code>CPU</code>当app正在运行的时候。</p>
<p><img src="http://ww4.sinaimg.cn/mw690/64124373gw1ezk4seggwgj20jg0a0ta0.jpg" alt="gauges"></p>
<p><em>Xcode的仪表视图表明，主线程的任务非常重</em></p>
<p>你会看到那些所有的长钉在<code>Thread 1</code>，那就是app的主线程。更多详细的信息你可以运行app的<code>Instruments</code>,但是那个在<a target="_blank" rel="noopener" href="http://www.raywenderlich.com/?p=23037"> whole other tutorial :].</a>中</p>
<p>是时候考虑怎样改善一下你的用户体验了！</p>
<h3 id="任务，线程和进程"><a href="#任务，线程和进程" class="headerlink" title="任务，线程和进程"></a>任务，线程和进程</h3><p>在你专研这篇教程之前，这里有一下技术上的慨念需要理一下，我将定义一些专用术语：</p>
<ul>
<li><strong>任务</strong> ：一个简单单个的需要完成的工作</li>
<li><strong>线程</strong> ：操作系统提供的机制允许多个用户操作同时进行在一个应用中</li>
<li><strong>进程</strong> ：一个可执行的代码块，它可以由多个线程构成</li>
</ul>
<blockquote>
<p>注意：在iOS和OS X中，线程的功能由POSIX线程API（或者 pthreads）实现，并且它使操作系统的一部分。而这个又是相当底层的东西，你将发现它很容易犯错误；或许关于线程最糟糕的事情是那些很难被发现的错误！</p>
</blockquote>
<blockquote>
<p><code>Foundation</code>框架包含了一个叫做<code>NSThread</code>的类，这让我们处理事情更容易，但是用<code>NSThread</code>管理多个线程仍是一件令人头疼的事情。<code>NSOperation</code>和<code>NSOperationQueue</code>是为了最大化简化处理多线程的更高级的类。</p>
</blockquote>
<p>在这个图解中，你会看到进程，线程和任务之间的关系：</p>
<p><img src="http://ww3.sinaimg.cn/mw690/64124373gw1ezk5dwtbhuj20go03n0t2.jpg" alt="the relationship between a process, threads, and tasks"></p>
<p><em>进程，线程和任务</em></p>
<p>正如你所见，一个进程可以包涵多个执行的线程，每个线程能够同时执行多个任务。</p>
<p>在这个图集中, <code>thread 2</code>执行文件的读的工作，同时<code>thread 1</code>执行UI相关的代码。这和你应该怎样在iOS中构建你的代码（主线程执行任何和UI相关的工作，第二线程应当执行慢的或者长时间运行的耗时操作例如读取文件，接入网络等等）有点相似。</p>
<h3 id="NSOperation-vs-Grand-Central-Dispatch-GCD"><a href="#NSOperation-vs-Grand-Central-Dispatch-GCD" class="headerlink" title="NSOperation vs. Grand Central Dispatch (GCD)"></a>NSOperation vs. Grand Central Dispatch (GCD)</h3><p>你应该听说过<a target="_blank" rel="noopener" href="http://developer.apple.com/library/ios/#documentation/Performance/Reference/GCD_libdispatch_Ref/Reference/reference.html">Grand Central Dispatch (GCD).</a>。简单的来说，<code>GCD</code>由语言的特征，运行时库和系统增强组成来提供一个在<code>iOS</code>和<code>OS X</code>多核硬件中支持并发系统并且综合的改良。假如你想了解更多关于GCD相关的知识，有可以阅读我们的<a target="_blank" rel="noopener" href="http://www.raywenderlich.com/?p=4295">Multithreading and Grand Central Dispatch on iOS for Beginners Tutorial</a>。</p>
<p><code>NSOperation</code>和<code>NSOperationQueue</code>构建在GCD之上。普遍来说，苹果推荐使用最高级别抽象，当需要显示他们一些需要的测量工作时回到最底层。</p>
<p>下面是关于这两者的一些简单比较，将帮助你决定何时何地选择使用<code>GCD</code>或者<code>NSOperation</code>：</p>
<ul>
<li><p><strong>GCD</strong> 是一个轻量级的方式来描述将要被并发执行的工作单元。你不必定制这个工作单元的时刻表；系统为你定制时刻表。在blocks中增加依赖是一件头疼的事情。取消或者暂停一个block来进行额外的工作为作为开发者的你！ :]</p>
</li>
<li><p><strong>NSOperation</strong> 和GCD相比增加了一些额外开支，但是你能够在各种操作之间增加依赖并且恢复，取消，暂停他们。</p>
</li>
</ul>
<p>这个教程将使用<code>NSOperation</code>,因为你将处理一个列表为了好的表现并且由于它大量的消耗的资源你需要能够取消一个操作针对某个图片，假如用户已经将那张图片滚出屏幕。即使这些操作在后台线程，假如这里有一打事情在队列里等着它们去处理，这将表现得跟糟糕。</p>
<h3 id="重构-App-Model"><a href="#重构-App-Model" class="headerlink" title="重构 App Model"></a>重构 App Model</h3><p>是时候重构开始的非多线程的模型了！假如你仔细观察先前的模型，你会发现这里有三个可以被改进的线程受困区域。通过切割这三个区域让后把他们放在单独的线程里，主线程的压力将得到缓解并且能够保持和用户交互。</p>
<p><img src="http://ww3.sinaimg.cn/mw690/64124373gw1ezk6m9a5xzj20i20nm416.jpg" alt="NSOperation_model_improved"></p>
<p><em>改进后的 model</em></p>
<p>为了摆脱你应用的瓶颈，你需要一个指定一个线程来响应你的用户时间，一个线程专注于下载资源和图片，一个线程执行图片滤镜操作。在新的模型中，app从主线程启动让后载入一个空的表视图。同时，app启动第二个线程开始下载数据资源。</p>
<p>一旦数据资源下载完成，你将通知表视图重新载入。这些事情必须在主线程完成，因为它涉及到用户界面相关的操作。从这一点来说，表视图知道有多少行，并且它知道他将显示图片的URL地址，但是她不知道它是否真的有图片！假如你立即开始下载所有的图片在这个点上，这可能导致效率极其低下，因为你不需要一次性把所有图片下载完！</p>
<p>为了让这个变得更好我们能够做什么？</p>
<p>一个更好的模型就是可交互的行在屏幕范围内可见时才开始下载图片。所以你的代码开始将询问表视图有多少行可见。因此，代码应该直到这里有一个未加滤镜的图片等待处理时才开始处理图片加滤镜操作。</p>
<p>为了使app更加快速响应，代码将要让图片一旦下载完毕立即显示。让后才开始进行图片加滤镜操作，让后更新UI界面来显示已经经过滤镜处理后的图片。下面的图标显示了这个过程的控制流：</p>
<p><img src="http://ww3.sinaimg.cn/mw690/64124373gw1ezk75nd4bdj20i206yq3q.jpg" alt="Control Flow"></p>
<p><em>Cotroll Flow</em></p>
<p>为了获得这些对象，你需要跟踪这张图片现在是否正在被下载，一旦完成下载，假如图片的滤镜被应用上。你需要跟跟踪每个操作的状态，它是否正在下载中或者执行滤镜操作，以便你能够取消，暂停或者恢复每个操作当用户滚动的时候。</p>
<p>Okey！ 现在你准备好开始码代码了！ :]</p>
<p>打开你下载的工程，添加一个新的<strong>Swift File</strong>到你的工程中命名为** PhotoOperations.swift**。添加下面代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PendingOperations</span> &#123;</span><br><span class="line">  <span class="keyword">lazy</span> <span class="keyword">var</span> downloadsInProgress <span class="operator">=</span> [<span class="type">NSIndexPath</span>:<span class="type">NSOperation</span>]()</span><br><span class="line">  <span class="keyword">lazy</span> <span class="keyword">var</span> downloadQueue:<span class="type">NSOperationQueue</span> <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> queue <span class="operator">=</span> <span class="type">NSOperationQueue</span>()</span><br><span class="line">    queue.name <span class="operator">=</span> <span class="string">&quot;Download queue&quot;</span></span><br><span class="line">    queue.maxConcurrentOperationCount <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> queue</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">lazy</span> <span class="keyword">var</span> filtrationsInProgress <span class="operator">=</span> [<span class="type">NSIndexPath</span>:<span class="type">NSOperation</span>]()</span><br><span class="line">  <span class="keyword">lazy</span> <span class="keyword">var</span> filtrationQueue:<span class="type">NSOperationQueue</span> <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> queue <span class="operator">=</span> <span class="type">NSOperationQueue</span>()</span><br><span class="line">    queue.name <span class="operator">=</span> <span class="string">&quot;Image Filtration queue&quot;</span></span><br><span class="line">    queue.maxConcurrentOperationCount <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> queue</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这回类包含了2个字典为了跟踪激活和正在进行中的下载和滤镜操作对表中的每一行，并且两个操作队列都有各自的操作类型。</p>
<p>所有的值被懒加载的方式创建，意味着他们不会被初始化知道他们第一次被接入。这样改善了你app的表现性能。</p>
<p>创建一个<code>NSOperationQueue</code>是非常简单的，正如你所见，给你的队列命名是非常有用的，因为名字会在仪器或者调速器中显示。<code>maxConcurrentOperationCount</code>在这里由于这个教程的缘故被设置成1，是为了让你看到操作一个接一个完成。你可以离开这一部分允许队列决定他一次处理多少个操作–这样会进一步改善性能。</p>
<p>队列是怎样决定一次运行多少个操作的呢？这是一个非常好的问题！ :] 这取决于硬件。默认，<code>NSOperationQueue</code>将要处理一写计算在屏幕背后，决定什么是最好的需要看代码是运行在某个具体的平台，和将载入的最大数量的线程数。</p>
<p>考虑到下面的例子，假设系统此时是空闲的，这里有很多资源可用，所以这个队列能够载入可能8条并发的线程。下一个时刻你运行程序，系统可能忙于其他不相关的正在抢夺资源的操作，这时队列就仅仅载入2个并发的线程。因为你已经设置了一个最大并发操作数，在这个app中一次只会进行一个操作。</p>
<blockquote>
<p>注意：你可能想知道为什么你必须跟踪所有的激活的和正在进行中操作。队列有一个<code>operations</code>的方法，它将返回一个操作的数组，所有为什么不用它呢？在这个工程中这样做效果不是很好。你需要跟踪更表视图行数关联的操作，它可能会重复执行数组每次你需要一个的时候。把它们储存在一个字典中用index path来作为他的key方便快速和高效的查找。</p>
</blockquote>
<p>是时候考虑下载和过滤操作了。添加下列代码到<code> PhotoOperations.swift:</code>文件的末尾：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ImageDownloader</span>: <span class="title class_ inherited__">NSOperation</span> &#123;</span><br><span class="line">  <span class="comment">//1</span></span><br><span class="line">  <span class="keyword">let</span> photoRecord: <span class="type">PhotoRecord</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//2</span></span><br><span class="line">  <span class="keyword">init</span>(<span class="params">photoRecord</span>: <span class="type">PhotoRecord</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.photoRecord <span class="operator">=</span> photoRecord</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//3</span></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">//4</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.cancelled &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5</span></span><br><span class="line">    <span class="keyword">let</span> imageData <span class="operator">=</span> <span class="type">NSData</span>(contentsOfURL:<span class="keyword">self</span>.photoRecord.url)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.cancelled &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7</span></span><br><span class="line">    <span class="keyword">if</span> imageData<span class="operator">?</span>.length <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.photoRecord.image <span class="operator">=</span> <span class="type">UIImage</span>(data:imageData<span class="operator">!</span>)</span><br><span class="line">      <span class="keyword">self</span>.photoRecord.state <span class="operator">=</span> .<span class="type">Downloaded</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">self</span>.photoRecord.state <span class="operator">=</span> .<span class="type">Failed</span></span><br><span class="line">      <span class="keyword">self</span>.photoRecord.image <span class="operator">=</span> <span class="type">UIImage</span>(named: <span class="string">&quot;Failed&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>NSOperation</code>是一个抽象类，为它的子类而设计。每个子类代表了一个特别的<code>任务</code>正如呈现在列表早期那样。</p>
<p>下面是上面代码每行注释到底发生了什么的说明：</p>
<ol>
<li>添加一个常量引用到和操作相关的<code>PhotoRecord</code>对象</li>
<li>创建一个设计初始化方法允许<code>photo record</code>参数可以被传进来</li>
<li><code>main</code>是你在<code>NSOperation</code>子类中需要重写的方法，用来执行相关工作</li>
<li>在启动开始前检查是否被取消，操作应该定期检查是否已经被取消在尝试长时间或密集的工作之前</li>
<li>下载图片数据</li>
<li>再次检查是否被取消</li>
<li>假如这里有数据，创建一个图片对象然后把它添加到记录中，同时改变它的状态，假如这里没有数据，把这条记录标记成失败然后设置适当的图片</li>
</ol>
<p>下一步，你将创建另一个操作来处理图片加滤镜的操作！添加下面的代码到<code>PhotoOperations.swift</code>文件末尾：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ImageFiltration</span>: <span class="title class_ inherited__">NSOperation</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> photoRecord: <span class="type">PhotoRecord</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(<span class="params">photoRecord</span>: <span class="type">PhotoRecord</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.photoRecord <span class="operator">=</span> photoRecord</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">main</span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.cancelled &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.photoRecord.state <span class="operator">!=</span> .<span class="type">Downloaded</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> filteredImage <span class="operator">=</span> <span class="keyword">self</span>.applySepiaFilter(<span class="keyword">self</span>.photoRecord.image<span class="operator">!</span>) &#123;</span><br><span class="line">      <span class="keyword">self</span>.photoRecord.image <span class="operator">=</span> filteredImage</span><br><span class="line">      <span class="keyword">self</span>.photoRecord.state <span class="operator">=</span> .<span class="type">Filtered</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了你对图片应用滤镜（使用一个未实现的方法，因此编译1错误）而不是下载它之外，这个看起来和下载操作非常相像。</p>
<p>添加遗失的图片滤镜处理方法到<code>ImageFiltration</code>类中:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(image:<span class="type">UIImage</span>) -&gt; <span class="type">UIImage</span>? &#123;</span><br><span class="line">  <span class="keyword">let</span> inputImage <span class="operator">=</span> <span class="type">CIImage</span>(data:<span class="type">UIImagePNGRepresentation</span>(image))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">self</span>.cancelled &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> context <span class="operator">=</span> <span class="type">CIContext</span>(options:<span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">let</span> filter <span class="operator">=</span> <span class="type">CIFilter</span>(name:<span class="string">&quot;CISepiaTone&quot;</span>)</span><br><span class="line">  filter.setValue(inputImage, forKey: kCIInputImageKey)</span><br><span class="line">  filter.setValue(<span class="number">0.8</span>, forKey: <span class="string">&quot;inputIntensity&quot;</span>)</span><br><span class="line">  <span class="keyword">let</span> outputImage <span class="operator">=</span> filter.outputImage</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">self</span>.cancelled &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> outImage <span class="operator">=</span> context.createCGImage(outputImage, fromRect: outputImage.extent())</span><br><span class="line">  <span class="keyword">let</span> returnImage <span class="operator">=</span> <span class="type">UIImage</span>(CGImage: outImage)</span><br><span class="line">  <span class="keyword">return</span> returnImage</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>图片添加滤镜操作使用先前<code>ListViewController</code>中相同的实现。已经把它移动到这里来了以至于它它能在后台的一个单独的操作中完成。再次强调，你应该非常频繁的检查取消操作；最佳实践是在进行任何耗时操作调用之前和之后。一旦加滤镜操作完成，你应该立即设置photo record 实例的值。</p>
<p>很棒！现在你已经有了所有的工具和基础为了处理后台任务进程的操作。是时候回到控制器修改它以便能利用所有这些新的福利。</p>
<p>切换到<code>ListViewController.swift</code>文件，然后删除<code>lazy var photos</code>接口声明。添加下面声明：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> photos <span class="operator">=</span> [<span class="type">PhotoRecord</span>]()</span><br><span class="line"><span class="keyword">let</span> pendingOperations <span class="operator">=</span> <span class="type">PendingOperations</span>()</span><br></pre></td></tr></table></figure>

<p>这些将持有一个数组的你在开始创建的<code>PhotoDetails</code>对象，<code>PendingOperations</code>对象来管理操作。</p>
<p>添加一个下载<code>photos property</code>列表新的方法到类中：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchPhotoDetails</span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> request <span class="operator">=</span> <span class="type">NSURLRequest</span>(URL:dataSourceURL<span class="operator">!</span>)</span><br><span class="line">  <span class="type">UIApplication</span>.sharedApplication().networkActivityIndicatorVisible <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="type">NSURLConnection</span>.sendAsynchronousRequest(request, queue: <span class="type">NSOperationQueue</span>.mainQueue()) &#123;response,data,error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> data <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> datasourceDictionary <span class="operator">=</span> <span class="type">NSPropertyListSerialization</span>.propertyListWithData(data, options: <span class="type">Int</span>(<span class="type">NSPropertyListMutabilityOptions</span>.<span class="type">Immutable</span>.rawValue), format: <span class="literal">nil</span>, error: <span class="literal">nil</span>) <span class="keyword">as!</span> <span class="type">NSDictionary</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(key : <span class="type">AnyObject</span>,value : <span class="type">AnyObject</span>) <span class="keyword">in</span> datasourceDictionary &#123;</span><br><span class="line">        <span class="keyword">let</span> name <span class="operator">=</span> key <span class="keyword">as?</span> <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">NSURL</span>(string:value <span class="keyword">as?</span> <span class="type">String</span> <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> name <span class="operator">!=</span> <span class="literal">nil</span> <span class="operator">&amp;&amp;</span> url <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> photoRecord <span class="operator">=</span> <span class="type">PhotoRecord</span>(name:name<span class="operator">!</span>, url:url<span class="operator">!</span>)</span><br><span class="line">          <span class="keyword">self</span>.photos.append(photoRecord)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">self</span>.tableView.reloadData()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> error <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> alert <span class="operator">=</span> <span class="type">UIAlertView</span>(title:<span class="string">&quot;Oops!&quot;</span>,message:error.localizedDescription, delegate:<span class="literal">nil</span>, cancelButtonTitle:<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">      alert.show()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">UIApplication</span>.sharedApplication().networkActivityIndicatorVisible <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法创建一个异步的网络请求，当完成的时候，将执行<code>completion block</code>在主线程。当下载完成property list的数据被萃取成一个<code>NSDictionary</code>,然后再次处理一个数组的<code>PhotoRecord</code>的对象。你不能直接使用这里的<code>NSOperation</code>,你应该在主线程中接入它使用<code>NSOperationQueue.mainQueue()</code>。</p>
<p>在<code>viewDidLoad</code>调用新方法</p>
<blockquote>
<p>fetchPhotoDetails()</p>
</blockquote>
<p>下一步找到<code> tableView(_:cellForRowAtIndexPath:)</code>然后替换它用下面的实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">tableView</span>(<span class="params">tableView</span>: <span class="type">UITableView</span>, <span class="params">cellForRowAtIndexPath</span> <span class="params">indexPath</span>: <span class="type">NSIndexPath</span>) -&gt; <span class="type">UITableViewCell</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> cell <span class="operator">=</span> tableView.dequeueReusableCellWithIdentifier(<span class="string">&quot;CellIdentifier&quot;</span>, forIndexPath: indexPath) <span class="keyword">as!</span> <span class="type">UITableViewCell</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//1</span></span><br><span class="line">  <span class="keyword">if</span> cell.accessoryView <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> indicator <span class="operator">=</span> <span class="type">UIActivityIndicatorView</span>(activityIndicatorStyle: .<span class="type">Gray</span>)</span><br><span class="line">    cell.accessoryView <span class="operator">=</span> indicator</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> indicator <span class="operator">=</span> cell.accessoryView <span class="keyword">as!</span> <span class="type">UIActivityIndicatorView</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//2</span></span><br><span class="line">  <span class="keyword">let</span> photoDetails <span class="operator">=</span> photos[indexPath.row]</span><br><span class="line"></span><br><span class="line">  <span class="comment">//3</span></span><br><span class="line">  cell.textLabel<span class="operator">?</span>.text <span class="operator">=</span> photoDetails.name</span><br><span class="line">  cell.imageView<span class="operator">?</span>.image <span class="operator">=</span> photoDetails.image</span><br><span class="line"></span><br><span class="line">  <span class="comment">//4</span></span><br><span class="line">  <span class="keyword">switch</span> (photoDetails.state)&#123;</span><br><span class="line">  <span class="keyword">case</span> .<span class="type">Filtered</span>:</span><br><span class="line">    indicator.stopAnimating()</span><br><span class="line">  <span class="keyword">case</span> .<span class="type">Failed</span>:</span><br><span class="line">    indicator.stopAnimating()</span><br><span class="line">    cell.textLabel<span class="operator">?</span>.text <span class="operator">=</span> <span class="string">&quot;Failed to load&quot;</span></span><br><span class="line">  <span class="keyword">case</span> .<span class="type">New</span>, .<span class="type">Downloaded</span>:</span><br><span class="line">    indicator.startAnimating()</span><br><span class="line">    <span class="keyword">self</span>.startOperationsForPhotoRecord(photoDetails,indexPath:indexPath)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> cell</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>花点时间来通读注释区域下面的解释：</p>
<ol>
<li>为了给用户提供反馈，创建<code>UIActivityIndicatorView</code>让后把它设成cell的accessory view。</li>
<li>数据源包含<code>PhotoRecord</code>实例。抓取正确的数据基于当前行的<code>indexPath</code>。</li>
<li>cell的文本标签总是一样的，图片被正确的设置在<code>PhotoRecord</code>中当它被处理的时候，以便你能够设置他们两者，而不管记录的状态。</li>
<li>检查记录，正确的设置activity indicator和文本，然后开始操作（暂时还没实现）</li>
</ol>
<p>你可以移除<code>applySepiaFilter</code>的实现，因为那个将不再被调用了，添加下面的方法到类中来开始操作：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">startOperationsForPhotoRecord</span>(<span class="params">photoDetails</span>: <span class="type">PhotoRecord</span>, <span class="params">indexPath</span>: <span class="type">NSIndexPath</span>)&#123;</span><br><span class="line">  <span class="keyword">switch</span> (photoDetails.state) &#123;</span><br><span class="line">  <span class="keyword">case</span> .<span class="type">New</span>:</span><br><span class="line">    startDownloadForRecord(photoDetails, indexPath: indexPath)</span><br><span class="line">  <span class="keyword">case</span> .<span class="type">Downloaded</span>:</span><br><span class="line">    startFiltrationForRecord(photoDetails, indexPath: indexPath)</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="type">NSLog</span>(<span class="string">&quot;do nothing&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里，你将传递一个<code>PhotoRecord</code>类型的实例带有它的<code>index path</code>。<br>依据<code>photo record</code>的状态，你选开始进行下载还是加滤镜的步骤。</p>
<blockquote>
<p>注意：下载图片和给图片加滤镜的方法分开实现，因为这里有可能出现当一个图片正在被下载，用户可能把它滚开了，这样你就不必对它应用滤镜操作。当下一次用户又来到相同的哪行时，你不必重新下载图片；你只需对它应用<br>图片滤镜即可！ Efficiency rocks! :]</p>
</blockquote>
<p>现在你需要实现你在上面调用的方法。记住你创建的自定义的类，<code>PendingOperations</code>,保持跟踪操作；现在实际上你可以使用它了！添加下面的方法到类中：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">startDownloadForRecord</span>(<span class="params">photoDetails</span>: <span class="type">PhotoRecord</span>, <span class="params">indexPath</span>: <span class="type">NSIndexPath</span>)&#123;</span><br><span class="line">  <span class="comment">//1</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> downloadOperation <span class="operator">=</span> pendingOperations.downloadsInProgress[indexPath] &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//2</span></span><br><span class="line">  <span class="keyword">let</span> downloader <span class="operator">=</span> <span class="type">ImageDownloader</span>(photoRecord: photoDetails)</span><br><span class="line">  <span class="comment">//3</span></span><br><span class="line">  downloader.completionBlock <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> downloader.cancelled &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), &#123;</span><br><span class="line">      <span class="keyword">self</span>.pendingOperations.downloadsInProgress.removeValueForKey(indexPath)</span><br><span class="line">      <span class="keyword">self</span>.tableView.reloadRowsAtIndexPaths([indexPath], withRowAnimation: .<span class="type">Fade</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//4</span></span><br><span class="line">  pendingOperations.downloadsInProgress[indexPath] <span class="operator">=</span> downloader</span><br><span class="line">  <span class="comment">//5</span></span><br><span class="line">  pendingOperations.downloadQueue.addOperation(downloader)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">startFiltrationForRecord</span>(<span class="params">photoDetails</span>: <span class="type">PhotoRecord</span>, <span class="params">indexPath</span>: <span class="type">NSIndexPath</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> filterOperation <span class="operator">=</span> pendingOperations.filtrationsInProgress[indexPath]&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> filterer <span class="operator">=</span> <span class="type">ImageFiltration</span>(photoRecord: photoDetails)</span><br><span class="line">  filterer.completionBlock <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> filterer.cancelled &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), &#123;</span><br><span class="line">      <span class="keyword">self</span>.pendingOperations.filtrationsInProgress.removeValueForKey(indexPath)</span><br><span class="line">      <span class="keyword">self</span>.tableView.reloadRowsAtIndexPaths([indexPath], withRowAnimation: .<span class="type">Fade</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  pendingOperations.filtrationsInProgress[indexPath] <span class="operator">=</span> filterer</span><br><span class="line">  pendingOperations.filtrationQueue.addOperation(filterer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Okey!下面是一个快速列表来帮助你立即上面的代码到底做了什么：</p>
<ol>
<li>首先，检查特定的<code>indexPath</code>来看这里是否已经有一个操作在<code>downloadsInProgress</code>中。假如有，忽略它。</li>
<li>假如没有，通过<code>designated initializer</code>创建一个<code>ImageDownloader</code>实例</li>
<li>添加一个当操作完成时执行的完成block。这是最好的地方让你其余的应用知道一个操作已经完成。注意完成block必须被执行即使这个操作被取消，这相当的重要，所以你需要使用GCD来触发重新载入表视图在主线程。</li>
<li>添加操作到<code>downloadsInProgress</code>中来保持跟踪一些事情。</li>
<li>添加操作到下载队列中。这是你实际获取这些操作开始运行的方法–队列需要注意的是一旦你添加了操作它就会执行。</li>
</ol>
<p>过滤图片的方法遵循下面相同的类型，除了它使用<code>ImageFiltration</code>和<code>filtrationsInProgress</code>来跟踪操作。作为经验，你应该尝试不要重复这个区域的代码 :]</p>
<p>你做到了！你的工程完成了。构建让后运行看有什么改进在操作上！当你滚动表视图的时候，app并没有停止，还是像它们变得可见一样继续下载图片和给图片加滤镜操作。</p>
<p><img src="http://ww2.sinaimg.cn/mw690/64124373gw1ezkc6fh23sj205x08wdga.jpg" alt="classicphotos-stalled-screenshot"></p>
<p><em>原来的图片，现在可以滚动了</em></p>
<p>是不是很酷？你能看到随做你的进步让你的应用更易于响应能做出的努力 –对用户来说更有趣！</p>
<h3 id="细微的调整"><a href="#细微的调整" class="headerlink" title="细微的调整"></a>细微的调整</h3><p>你已经随着这个教程走过漫长的路！你的小项目现在反应灵敏表明了在原来的版本基础上有很多改进。然而，这里任然有一些遗留的细节我们需要考虑。你是想成为一名伟大的程序员，而不仅仅是一名优秀的程序员！</p>
<p>你可能已经注意到了当你滚动表视图时，那些离屏的cell仍然在处理下载和给图片加滤镜的操作。假如你快速滚动，app将忙于下载和给图片处理滤镜的操作，在列表中从最前面甚至到不可见的地方。理想的情况下app应该对离开屏幕的cells就是现在不可见的取消滤镜操作。</p>
<p>难道你没有把取消的规定放进你的代码里？ 是的，你做了–现在你应该充分利用它们！:]</p>
<p>回到Xcode，让后打开<code>ListViewController.swift</code>文件。去到<code>tableView(_:cellForRowAtIndexPath:)</code>方法的实现，封装<code>startOperationsForPhotoRecord</code>调用在一个if条件向下面的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="operator">!</span>tableView.dragging <span class="operator">&amp;&amp;</span> <span class="operator">!</span>tableView.decelerating) &#123;</span><br><span class="line">  <span class="keyword">self</span>.startOperationsForPhotoRecord(photoDetails, indexPath: indexPath)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你需要告诉表视图开始操作仅仅当表视图没有滚动的时候。这实际上是<code>UIScrollView</code>的接口，由于<code>UITableView</code>是<code>UIScrollView</code>的子类，你自动继承了这些接口。</p>
<p>下一步，添加到下面<code>UIScrollView</code>代理方法的实现到类中：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">scrollViewWillBeginDragging</span>(<span class="params">scrollView</span>: <span class="type">UIScrollView</span>) &#123;</span><br><span class="line">  <span class="comment">//1</span></span><br><span class="line">  suspendAllOperations()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">scrollViewDidEndDragging</span>(<span class="params">scrollView</span>: <span class="type">UIScrollView</span>, <span class="params">willDecelerate</span> <span class="params">decelerate</span>: <span class="type">Bool</span>) &#123;</span><br><span class="line">  <span class="comment">// 2</span></span><br><span class="line">  <span class="keyword">if</span> <span class="operator">!</span>decelerate &#123;</span><br><span class="line">    loadImagesForOnscreenCells()</span><br><span class="line">    resumeAllOperations()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">scrollViewDidEndDecelerating</span>(<span class="params">scrollView</span>: <span class="type">UIScrollView</span>) &#123;</span><br><span class="line">  <span class="comment">// 3</span></span><br><span class="line">  loadImagesForOnscreenCells()</span><br><span class="line">  resumeAllOperations()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>快速走查上面的代码显示在下面：</p>
<ol>
<li>当用户开始滚动，你想暂停所有的操作让后看看用户想看到什么。你将要实现<code>suspendAllOperations</code>在一会儿工夫。</li>
<li>假如<code>decelerate</code>的值是<code>false</code>,那就意味着停止拖拽表视图，因此你想恢复暂停的，因为cell离开屏幕取消的操作，启动在屏幕内cells的操作。你将要一起实现<code>loadImagesForOnscreenCells</code>和<code>resumeAllOperations</code>。</li>
<li>代理方法告诉你表视图已经停止滚动，所以你将做和#2条相同的处理。</li>
</ol>
<p>现在，添加下面这些遗失的方法的实现到<code>ListViewController.swift</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">suspendAllOperations</span> () &#123;</span><br><span class="line">  pendingOperations.downloadQueue.suspended <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">  pendingOperations.filtrationQueue.suspended <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">resumeAllOperations</span> () &#123;</span><br><span class="line">  pendingOperations.downloadQueue.suspended <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  pendingOperations.filtrationQueue.suspended <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">loadImagesForOnscreenCells</span> () &#123;</span><br><span class="line">  <span class="comment">//1</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> pathsArray <span class="operator">=</span> tableView.indexPathsForVisibleRows() &#123;</span><br><span class="line">    <span class="comment">//2</span></span><br><span class="line">    <span class="keyword">var</span> allPendingOperations <span class="operator">=</span> <span class="type">Set</span>(pendingOperations.downloadsInProgress.keys.array)</span><br><span class="line">    allPendingOperations.unionInPlace(pendingOperations.filtrationsInProgress.keys.array)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3</span></span><br><span class="line">    <span class="keyword">var</span> toBeCancelled <span class="operator">=</span> allPendingOperations</span><br><span class="line">    <span class="keyword">let</span> visiblePaths <span class="operator">=</span> <span class="type">Set</span>(pathsArray <span class="keyword">as!</span> [<span class="type">NSIndexPath</span>])</span><br><span class="line">    toBeCancelled.subtractInPlace(visiblePaths)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4</span></span><br><span class="line">    <span class="keyword">var</span> toBeStarted <span class="operator">=</span> visiblePaths</span><br><span class="line">    toBeStarted.subtractInPlace(allPendingOperations)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5</span></span><br><span class="line">    <span class="keyword">for</span> indexPath <span class="keyword">in</span> toBeCancelled &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> pendingDownload <span class="operator">=</span> pendingOperations.downloadsInProgress[indexPath] &#123;</span><br><span class="line">        pendingDownload.cancel()</span><br><span class="line">      &#125;</span><br><span class="line">      pendingOperations.downloadsInProgress.removeValueForKey(indexPath)</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> pendingFiltration <span class="operator">=</span> pendingOperations.filtrationsInProgress[indexPath] &#123;</span><br><span class="line">        pendingFiltration.cancel()</span><br><span class="line">      &#125;</span><br><span class="line">      pendingOperations.filtrationsInProgress.removeValueForKey(indexPath)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6</span></span><br><span class="line">    <span class="keyword">for</span> indexPath <span class="keyword">in</span> toBeStarted &#123;</span><br><span class="line">      <span class="keyword">let</span> indexPath <span class="operator">=</span> indexPath <span class="keyword">as</span> <span class="type">NSIndexPath</span></span><br><span class="line">      <span class="keyword">let</span> recordToProcess <span class="operator">=</span> <span class="keyword">self</span>.photos[indexPath.row]</span><br><span class="line">      startOperationsForPhotoRecord(recordToProcess, indexPath: indexPath)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>suspendAllOperations</code>和<code>resumeAllOperations</code>有一个简单的实现。<code>NSOperationQueues</code>能够被暂停，通过设置<code>suspended</code>接口为<code>true</code>。这将暂停队列里面的所有操作–你不能单独暂停一个操作。</p>
<p><code>loadImagesForOnscreenCells</code>有一点小复杂。这里发生了什么事？</p>
<ol>
<li>以一个包含了现在表视图可见的<code>index paths</code>的数组开始开始</li>
<li>构造一个所有进行中的操作的集合通过结合所有在下载的进度+所有在处理滤镜的进度。</li>
<li>构造一个<code>index paths</code>集合用来取消操作。开始所有的操作，然后移除可见行的<code>index paths</code>，这样讲留下一个离开屏幕的行正在执行的操作集合</li>
<li>构造一个<code>index paths</code>集合，需要操作启动，用所有可见行的<code>index paths</code>启动，让后移除它们中在进行的操作。</li>
<li>遍历那些被取消的操作，取消它们，然后移除它们的引用从<code>PendingOperations</code>。</li>
<li>遍历那些将要开始的操作，然后对他们每个调用<code>startOperationsForPhotoRecord</code>。</li>
</ol>
<p>构建运行然后你发现一个更流畅，资源管理德更好的应用！给你自己一轮掌声！</p>
<p><img src="http://ww2.sinaimg.cn/mw690/64124373gw1ezkdl5q55nj20jg09qq4h.jpg" alt="improved app"></p>
<p><em>原来的相册，载入东西一次一个</em></p>
<p>注意到当你完成滚动表视图，在可见区域行的cell的图片立即开始处理。</p>
<h3 id="何去何从？"><a href="#何去何从？" class="headerlink" title="何去何从？"></a>何去何从？</h3><p>这里是<a target="_blank" rel="noopener" href="http://cdn2.raywenderlich.com/wp-content/uploads/2014/10/ClassicPhotos-Final63.zip">completed version of the project</a>。</p>
<blockquote>
<p>注意：此教程写于<code>Update 17 April 2015: Updated for Xcode 6.3 and Swift 1.2</code>,现在Swift最新版本2.1使用Xcode7+以上编辑会报错，这里打包一个新语法修改版<a target="_blank" rel="noopener" href="https://github.com/wangruofeng/ClassicPhotos-Starter-fixed/archive/master.zip">completed fixed version of the project</a>。</p>
</blockquote>
<p>假如你完成这个工程应该花时间来真正理解它，恭喜你！你可以认为你自己是一位更有价值iOS开发者了比起在教程刚开始的时候！大多数开发的公司是非常幸运的有一个或者两个人正在知道这个东西。</p>
<p>当时请当心 – 像多层嵌套的blocks,不必要的使用多线程可能让一个工程变得难以理解对维护你代码的人来说。线程可能引入一些难以捉摸的bugs，将永远不出现知道你网络非常慢，或者代码运行在一个更快（或更慢）的设备上，或一个不同数量的核的芯片上时。小心测试，尽量使用<code>Instruments</code>（或者你自己的观察）来确定引入多线程真的有很大改进。</p>
<p>一个有用的特征使用操作时在这里没涉及到就是依赖（<code>dependency</code>）。你可以给一个操作添加一个或者更多的操作的依赖。这个操作不会开始直到它所有依赖的操作完成时。例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyDownloadOperation is a subclass of NSOperation</span></span><br><span class="line"><span class="keyword">let</span> downloadOperation <span class="operator">=</span> <span class="type">MyDownloadOperation</span>()</span><br><span class="line"><span class="comment">// MyFilterOperation  is a subclass of NSOperation</span></span><br><span class="line"><span class="keyword">let</span> filterOperation <span class="operator">=</span> <span class="type">MyFilterOperation</span>()</span><br><span class="line"></span><br><span class="line">filterOperation.addDependency(downloadOperation)</span><br></pre></td></tr></table></figure>

<p>移除依赖：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterOperation.removeDependency(downloadOperation)</span><br></pre></td></tr></table></figure>

<p>这个工程是否能使用依赖简化呢？把你学到的新技能用起来试一试 ：]<br>有件非常重要的事需要注意的就是一个依赖操作将仍然启动假如它依赖的操作被取消，还有它将自然完成。你需要牢记在心。</p>
<p>假如你有任何评论或者问题关于这个教程或者<code>NSOperations</code>,请加<a target="_blank" rel="noopener" href="https://github.com/wangruofeng/Github_Blog/pulls">Pull request</a>。</p>
<p>译者注：欢迎转载，但请一定注明出处！ <a href="http://blog.wangruofeng007.com/">http://blog.wangruofeng007.com</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



                        </div>
                        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

                    </div>
                        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">王若风</p>
  <div class="site-description" itemprop="description">王若风的技术博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangruofeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangruofeng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangruofeng007@gmail.com" title="E-Mail → mailto:wangruofeng007@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/oneruofeng" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;oneruofeng" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/ace_freeman007" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;ace_freeman007" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


                </div>
            </main>

            <footer class="footer">
                <div class="footer-inner">
                    

                    

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王若风</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">99k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">6:01</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

                    








                </div>
            </footer>
        </div>

        
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




        




  
<script src="/js/local-search.js"></script>














        
            <script
                type="text/javascript"
                src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
        
            

            

    </body>
</html>