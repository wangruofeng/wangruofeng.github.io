<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Animation | ç‹è‹¥é£çš„æŠ€æœ¯åšå®¢]]></title>
  <link href="http://wangruofeng.github.io/blog/categories/animation/atom.xml" rel="self"/>
  <link href="http://wangruofeng.github.io/"/>
  <updated>2016-01-19T23:27:35+08:00</updated>
  <id>http://wangruofeng.github.io/</id>
  <author>
    <name><![CDATA[ç‹è‹¥é£]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[iOS Animation Swift ç‰ˆ]]></title>
    <link href="http://wangruofeng.github.io/blog/2016/01/16/ios-animation-swift-ban/"/>
    <updated>2016-01-16T19:34:06+08:00</updated>
    <id>http://wangruofeng.github.io/blog/2016/01/16/ios-animation-swift-ban</id>
    <content type="html"><![CDATA[<p><img src="http://ww2.sinaimg.cn/large/64124373gw1f01qjo2k00j21g00ejjvd.jpg" alt="coreAnimation" /></p>

<h3>ç®€ä»‹</h3>

<p>æ­¤æ–‡ä¸»è¦è®°å½•æˆ‘å­¦ä¹ iOSçš„åŠ¨ç”»ç›¸å…³å†…å®¹ç”¨<code>Swift</code>è¯­è¨€ï¼Œè®°å½•ä¸‹æ¥ä»¥ä¾›å‚è€ƒï¼Œä¸å®šæ—¶æ›´æ–°ã€‚</p>

<h3>ç›®å½•ç»“æ„</h3>

<ul>
<li>Section I: View åŠ¨ç”»

<ul>
<li>View animation</li>
<li>å¼¹ç°§åŠ¨ç”» - Springs</li>
<li>è½¬åœºåŠ¨ç”» - Transitions</li>
<li>å…³é”®å¸§åŠ¨ç”» - Keyframe</li>
</ul>
</li>
<li>Section II: Auto Layout åŠ¨ç”»</li>
<li>Section III: Layer åŠ¨ç”»</li>
<li>Section IV: 3D åŠ¨ç”»</li>
<li>Section V: æœªæ¥ç±»å‹çš„åŠ¨ç”»</li>
<li>Section VI: View Controller åŠ¨ç”»</li>
<li>Section VIIï¼šç¬¬ä¸‰æ–¹åŠ¨ç”»åº“</li>
</ul>


<h4>Section I: View åŠ¨ç”»</h4>

<h5>1.View animation</h5>

<p>ç®€ä»‹ï¼šview çš„åŠ¨ç”»ä¸»è¦æ˜¯é€šè¿‡UIViewçš„ç±»æ–¹æ³•åˆ›å»ºï¼ŒåŠ¨ç”»å†…å®¹ä¸€èˆ¬
æ”¾åœ¨blocké‡Œé¢ï¼Œå¯ä»¥é•¶åµŒä½¿ç”¨ï¼Œæ„æˆé“¾å¼åŠ¨ç”»ï¼Œä¸»è¦æœ‰3ä¸ªæ–¹æ³•,ä¸‰ä¸ªè®¿æ³•åªéœ€ä¼šå‚æ•°æœ€å¤šçš„é‚£ä¸ªå°±è¡Œï¼Œå‡½æ•°å<code>animateWithDuration(_:delay:options:animations:completion:)</code>ï¼Œå…¶ä»–çš„ä½¿ç”¨èµ·æ¥éƒ½ç±»ä¼¼ã€‚</p>

<pre><code class="swift">class func animateWithDuration(_ duration: NSTimeInterval, animations animations: () -&gt; Void)
class func animateWithDuration(_ duration: NSTimeInterval, animations animations: () -&gt; Void, completion completion: ((Bool) -&gt; Void)?)
class func animateWithDuration(_ duration: NSTimeInterval, delay delay: NSTimeInterval, options options: UIViewAnimationOptions, animations animations: () -&gt; Void, completion completion: ((Bool) -&gt; Void)?)
</code></pre>

<p>ä½¿ç”¨ï¼š
<code>swift
UIView.animateWithDuration(0.5, delay: 0, options: [], animations: {
    //do something
  }, completion: {_ in
    //do something
})
</code></p>

<blockquote><p>è¯´æ˜ï¼š<code>options</code>ï¼ŒåŠ¨ç”»é€‰é¡¹ï¼Œè¿™ä¸ªè¿è¡Œä½ è®¾ç½®ä¸€ä¸ªåŠ¨ç”»é€‰é¡¹é›†åˆï¼Œä¼ <code>[]</code>è¡¨ç¤ºä¸éœ€è¦é€‰é¡¹ï¼Œå•ä¸ªæ—¶å¯ä»¥çœç•¥æ”¾æ‹¬å·ä¾‹å¦‚<code>.Repeat</code>,å¤šä¸ªç”¨é€—å·è¿æ¥<code>[.Repeat, .CurveEaseInOut]</code></p>

<p><code>completion</code>é—­åŒ…éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä¸éœ€è¦ä½¿ç”¨å‚æ•°å¯ä»¥ç”¨<code>_</code>è¡¨ç¤ºï¼Œä¸éœ€è¦å®ç°å¯ä»¥ç›´æ¥ä¼ <code>nil</code></p></blockquote>

<p>æˆ–è€…åƒä¸‹é¢è¿™æ ·å†™</p>

<pre><code class="swift">UIView.animateWithDuration(0.5, delay: 0, options: [], animations: { () -&gt; Void in
  //do something
  }) { (_) -&gt; Void in
  //do something
}
</code></pre>

<h5>2.å¼¹ç°§åŠ¨ç”» - Springs</h5>

<p>ç®€ä»‹ï¼šå¼¹ç°§åŠ¨ç”»æ˜¯iOS 7.0æ–°å¢çš„APIï¼Œå‡½æ•°å<code>animateWithDuration(_:delay:usingSpringWithDamping:initialSpringVelocity:opti ons:animations:completion:)</code>ï¼Œ</p>

<pre><code class="swift">class func animateWithDuration(_ duration: NSTimeInterval, delay delay: NSTimeInterval, usingSpringWithDamping dampingRatio: CGFloat, initialSpringVelocity velocity: CGFloat, options options: UIViewAnimationOptions, animations animations: () -&gt; Void, completion completion: ((Bool) -&gt; Void)?)
</code></pre>

<p>ä½¿ç”¨ï¼š
<code>swift
UIView.animateWithDuration(0.5, delay: 0.5, usingSpringWithDamping: 0.5, initialSpringVelocity: 0.0, options: [], animations: {
// do something
}, completion: nil)
</code></p>

<blockquote><p>è¯´æ˜ï¼š<code>usingSpringWithDamping</code>:è®¾ç½®å¼¹ç°§çš„é˜»å°¼ï¼ŒèŒƒå›´ï¼ˆ0.0-1.0ï¼‰ï¼Œè¶Šæ¥è¿‘0.0å¼¹ç°§è¶Šæœ‰å¼¹æ€§ï¼Œè¶Šæ¥è¿‘1.0ï¼Œæ•ˆæœè¶Šåƒµç¡¬ï¼Œä½ å¯ä»¥æŠŠå½“æˆå¼¹ç°§çš„åˆšåº¦æ¥ç†è§£ï¼Œ
<code>initialSpringVelocity</code>:è®¾ç½®å¼¹ç°§åˆå§‹åŒ–çš„é€Ÿåº¦ï¼Œè®¾ç½®1.0è¡¨ç¤ºç”¨1ç§’åœ¨åŠ¨ç”»è·¨åº¦ä¸Šå®Œæˆæ•´ä¸ªåŠ¨ç”»è·ç¦»ï¼Œå€¼è¶Šå¤§æˆ–è€…è¶Šå°ä¼šå¯¼è‡´åŠ¨ç”»æœ‰ç›¸åº”çš„å¤§çš„æˆ–è€…è¾ƒå°çš„é€Ÿåº¦ï¼Œå¯ä»¥å½“æˆå¼¹ç°§çš„åˆå§‹åŠ¨é‡æ¥ç†è§£ã€‚</p></blockquote>

<h5>3.è½¬åœºåŠ¨ç”» - Transitions</h5>

<p>ç®€ä»‹ï¼šå‰ä¸¤ç§åˆ›å»ºçš„åŠ¨ç”»æ˜¯åŸºäºå¯åŠ¨ç”»çš„æ¥å£ä¾‹å¦‚ï¼Œpositionï¼Œalphaï¼Œframeç­‰ç­‰ï¼ŒTransitionsæ˜¯ä¸“é—¨å¤„ç†æ·»åŠ æˆ–è€…ç§»é™¤ä¸€ä¸ªviewçš„åŠ¨ç”»,ç³»ç»Ÿæœ‰2ä¸ªæ ‡å‡†å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯å¯¹å•ä¸ªviewçš„å¤„ç†ï¼Œä¸€ä¸ªæ˜¯å¤„ç†2ä¸ªviewæ›¿æ¢ã€‚</p>

<pre><code class="swift">class func transitionWithView(_ view: UIView, duration duration: NSTimeInterval, options options: UIViewAnimationOptions, animations animations: (() -&gt; Void)?, completion completion: ((Bool) -&gt; Void)?)
class func transitionFromView(_ fromView: UIView, toView toView: UIView, duration duration: NSTimeInterval, options options: UIViewAnimationOptions, completion completion: ((Bool) -&gt; Void)?)
</code></pre>

<p>ä½¿ç”¨ï¼š
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">//add the new view via transition</span>
</span><span class='line'><span class="bp">UIView</span><span class="p">.</span><span class="n">transitionWithView</span><span class="p">(</span><span class="n">animationContainerView</span><span class="o">!</span><span class="p">,</span> <span class="nl">duration</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span>
</span><span class='line'><span class="nl">options</span><span class="p">:</span> <span class="p">[.</span><span class="n">CurveEaseOut</span><span class="p">,</span> <span class="p">.</span><span class="n">TransitionFlipFromBottom</span><span class="p">],</span> <span class="nl">animations</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">animationContainerView</span><span class="o">!</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">newView</span><span class="p">)</span> <span class="p">},</span> <span class="nl">completion</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">//remove the view via transition</span>
</span><span class='line'><span class="bp">UIView</span><span class="p">.</span><span class="n">transitionWithView</span><span class="p">(</span><span class="n">animationContainerView</span><span class="o">!</span><span class="p">,</span> <span class="nl">duration</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span>
</span><span class='line'><span class="nl">options</span><span class="p">:</span> <span class="p">[.</span><span class="n">CurveEaseOut</span><span class="p">,</span> <span class="p">.</span><span class="n">TransitionFlipFromBottom</span><span class="p">],</span> <span class="nl">animations</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">newView</span><span class="p">.</span><span class="n">removeFromSuperview</span><span class="p">()</span> <span class="p">},</span> <span class="nl">completion</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">//hide the view via transition</span>
</span><span class='line'><span class="bp">UIView</span><span class="p">.</span><span class="n">transitionWithView</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">newView</span><span class="p">,</span> <span class="nl">duration</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span> <span class="nl">options</span><span class="p">:</span> <span class="p">[.</span><span class="n">CurveEaseOut</span><span class="p">,</span> <span class="p">.</span><span class="n">TransitionFlipFromBottom</span><span class="p">],</span> <span class="nl">animations</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">newView</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="nb">true</span> <span class="p">},</span> <span class="nl">completion</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">//replace via transition</span>
</span><span class='line'><span class="bp">UIView</span><span class="p">.</span><span class="n">transitionFromView</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">oldView</span><span class="o">!</span><span class="p">,</span> <span class="nl">toView</span><span class="p">:</span> <span class="nb">self</span><span class="p">.</span><span class="n">newView</span><span class="o">!</span><span class="p">,</span> <span class="nl">duration</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span> <span class="nl">options</span><span class="p">:</span> <span class="p">[.</span><span class="n">TransitionFlipFromTop</span><span class="p">],</span>
</span><span class='line'><span class="nl">completion</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></p>

<h5>4.å…³é”®å¸§åŠ¨ç”» - Keyframe</h5>

<p>ç®€ä»‹ï¼šå…³é”®å¸§é¡¾åæ€ä¹‰å°±æ˜¯è®¾å®šå…³é”®çš„ä¸€äº›å¸§ç„¶åç³»ç»Ÿä¼šæ ¹æ®ä¸€å¥—ç®—æ³•è®¡ç®—ä¸­é—´çš„å…¶ä»–å¸§ï¼Œè¿™æ ·æ”¹å˜çš„å¯åŠ¨ç”»å±æ€§æ—¶çœ‹çœ‹èµ·æ¥æ›´åŠ æµç•…è‡ªç„¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå‡½æ•°,ä¸€ä¸ªåˆ›å»ºå…³é”®å¸§åŠ¨ç”»ï¼Œä¸€ä¸ªè®¾ç½®å…·ä½“æ¯å¸§å†…å®¹</p>

<pre><code class="swift">class func animateKeyframesWithDuration(_ duration: NSTimeInterval, delay delay: NSTimeInterval, options options: UIViewKeyframeAnimationOptions, animations animations: () -&gt; Void, completion completion: ((Bool) -&gt; Void)?)
+ (void)addKeyframeWithRelativeStartTime:(double)frameStartTime relativeDuration:(double)frameDuration animations:(void (^)(void))animations
</code></pre>

<p>ä¾‹å¦‚ï¼š
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">planeDepart</span><span class="p">()</span> <span class="p">{</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="bp">UIView</span><span class="p">.</span><span class="n">animateKeyframesWithDuration</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="nl">delay</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nl">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nl">animations</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//add keyframes&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="bp">UIView</span><span class="p">.</span><span class="n">addKeyframeWithRelativeStartTime</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nl">relativeDuration</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="nl">animations</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">100.0</span>
</span><span class='line'>  <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="mf">10.0</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>  <span class="bp">UIView</span><span class="p">.</span><span class="n">addKeyframeWithRelativeStartTime</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="nl">relativeDuration</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">CGAffineTransformMakeRotation</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">(</span><span class="o">-</span><span class="n">M_PI_4</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="bp">UIView</span><span class="p">.</span><span class="n">addKeyframeWithRelativeStartTime</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="nl">relativeDuration</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">100.0</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="mf">60.0</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="bp">UIView</span><span class="p">.</span><span class="n">addKeyframeWithRelativeStartTime</span><span class="p">(</span><span class="mf">0.51</span><span class="p">,</span> <span class="nl">relativeDuration</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">CGAffineTransformIdentity</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="bp">CGPoint</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="n">originalCenter</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="bp">UIView</span><span class="p">.</span><span class="n">addKeyframeWithRelativeStartTime</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="nl">relativeDuration</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">planeImage</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">originalCenter</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">},</span> <span class="nl">completion</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<blockquote><p>è¯´æ˜ï¼šè¿™æ˜¯è®¾è®¡ä¸€ä¸ªé£æœºæ²¿ä¸€æ¡è·¯å¾„èµ·é£ç„¶åå†å½’ä½çš„ä¸€æ®µåŠ¨ç”»ï¼Œ<code>addKeyframeWithRelativeStartTime(_:relativeDuration:animations:)</code>,ç¬¬ä¸€ä¸ªå‚æ•°ç›¸å¯¹å¼€å§‹æ—¶é—´ï¼Œæ˜¯ç›¸å¯¹äºåŠ¨ç”»æŒç»­æ—¶é—´çš„ç™¾åˆ†æ¯”ï¼Œä¾‹å¦‚0.1å°±æ˜¯10%ï¼Œ0.25å°±æ˜¯25%ï¼Œå¦‚æœæ•´ä¸ªåŠ¨ç”»æŒç»­2ç§’ï¼Œ0.1å°±æ˜¯åœ¨2*0.1=0.2ç§’çš„æ—¶å€™å¼€å§‹ï¼Œåé¢çš„ä¸€ä¸ªå‚æ•°æ˜¯ç›¸å¯¹æŒç»­æ—¶é—´ï¼ŒèŒƒå›´æ›´ç¬¬ä¸€å‚æ•°ç±»ä¼¼ä¹Ÿ(0.0-1.0),åªä»ç›¸å¯¹å¼€å§‹æ—¶é—´èµ·ï¼Œå¾€åæ¨ç§»çš„ç›¸å¯¹æ—¶é—´ã€‚</p></blockquote>

<p>å¤‡æ³¨ï¼šæ¬¢è¿è½¬è½½ï¼Œä½†è¯·ä¸€å®šæ³¨æ˜å‡ºå¤„ï¼ <a href="http://blog.wangruofeng007.com">http://blog.wangruofeng007.com</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç”¨CAShapeLayeråŠ¨ç”»ç»˜åˆ¶CGPath]]></title>
    <link href="http://wangruofeng.github.io/blog/2016/01/13/dong-hua-hui-zhi-cashapelayerde-lu-jing-cgpath/"/>
    <updated>2016-01-13T04:35:42+08:00</updated>
    <id>http://wangruofeng.github.io/blog/2016/01/13/dong-hua-hui-zhi-cashapelayerde-lu-jing-cgpath</id>
    <content type="html"><![CDATA[<ul>
<li><a href="http://oleb.net/blog/2010/12/animating-drawing-of-cgpath-with-cashapelayer/">åŸæ–‡é“¾æ¥</a></li>
</ul>


<h4>è¿™æ˜¯ä»€ä¹ˆï¼Ÿ</h4>

<blockquote><p>æ­¤æ–‡å°†è®²è§£é€šè¿‡å½¢çŠ¶å›¾å±‚<code>CAShaperLayer</code>çš„<code>strokeStart</code>å’Œ<code>strokeEnd</code>æ¥å®ç°åŠ¨ç”»ç»˜åˆ¶è·¯å¾„<code>CGPath</code>,æ­¤æ–‡æ˜¯<a href="http://oleb.net">By Ole Begemann</a>åˆ›å»ºäºDecember 18, 2010,å½“æ—¶æ˜¯å‘å¸ƒiOS SDK 4.2æ—¶<code>CAShapeLayer</code>æ–°å¢åŠ çš„ä¸¤ä¸ªå±æ€§<a href="http://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAShapeLayer_class/Reference/Reference.html#//apple_ref/doc/uid/TP40008314-CH1-SW16">strokeStart</a>å’Œ<a href="http://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAShapeLayer_class/Reference/Reference.html#//apple_ref/doc/uid/TP40008314-CH1-SW15">strokeEnd</a>,è¿™ä¸¤ä¸ªå€¼æ˜¯ä¸¤ä¸ªæµ®ç‚¹æ•°å–å€¼èŒƒå›´0.0~1.0,ç”¨æ¥è¡¨æ˜å½¢çŠ¶å›¾å±‚æ‰€æŒ‡å‘çš„è·¯å¾„åœ¨ç»˜åˆ¶å¼€å§‹å’Œç»“æŸè·¯å¾„ä¸­çš„ç›¸å¯¹ä½ç½®ã€‚</p></blockquote>

<p><code>strokeStart</code>é»˜è®¤å€¼æ˜¯0.0ï¼Œ<code>strokeEnd</code>é»˜è®¤å€¼æ˜¯1.0ï¼Œæ˜¾ç„¶è¿™ä¼šå¯¼è‡´å½¢çŠ¶å›¾å±‚çš„è·¯å¾„å°†ä¸€æ•´ä¸ªè¢«ç»˜åˆ¶ã€‚å‡å¦‚ï¼Œä½ æƒ³è¯´ï¼Œå¦‚æœè®¾ç½®äº†layer.strokeEnd = 0.5f,åªè®©å¥¹ç»˜åˆ¶å‰åŠéƒ¨åˆ†ï¼Œé‚£è¯¥å¤šå¥½ã€‚</p>

<p>çœŸæ­£æœ‰è¶£çš„äº‹æƒ…æ˜¯è¿™äº›æ¥å£éƒ½æ˜¯å¯åŠ¨ç”»çš„ã€‚é€šè¿‡åŠ¨ç”»ç»˜åˆ¶<code>strokeEnd</code>ä»0.0åˆ°1.0åœ¨å‡ ç§’å†…ï¼Œæˆ‘ä»¬å°±èƒ½å¾ˆå®¹æ˜“è‡ªå·±ç»˜åˆ¶è·¯å¾„åƒä¸‹é¢è¿™æ ·å†™ï¼š</p>

<pre><code class="objective-c">CABasicAnimation *pathAnimation = [CABasicAnimation animationWithKeyPath:@"strokeEnd"];
pathAnimation.duration = 10.0;
pathAnimation.fromValue = [NSNumber numberWithFloat:0.0f];
pathAnimation.toValue = [NSNumber numberWithFloat:1.0f];
[self.pathLayer addAnimation:pathAnimation forKey:@"strokeEndAnimation"];
</code></pre>

<p>æœ€åï¼Œå†æ·»åŠ ç¬¬äºŒä¸ªå›¾å±‚åŒ…å«ä¸€ä¸ªé“…ç¬”å›¾ç‰‡ï¼Œä½¿ç”¨å…³é”®å¸§åŠ¨ç”»<code>CAKeyframeAnimation</code>æ¥è®©å®ƒéšç€è¿™ä¸ªè·¯å¾„ä»¥ç›¸åŒçš„é€Ÿåº¦ç»˜åˆ¶ï¼Œå°±å¯ä»¥è¾¾åˆ°å®Œç¾çš„é”™è§‰æ•ˆæœï¼š</p>

<pre><code class="objective-c">CAKeyframeAnimation *penAnimation = [CAKeyframeAnimation animationWithKeyPath:@"position"];
penAnimation.duration = 10.0;
penAnimation.path = self.pathLayer.path;
penAnimation.calculationMode = kCAAnimationPaced;
[self.penLayer addAnimation:penAnimation forKey:@"penAnimation"];
</code></pre>

<p><a href="http://oleb.net/media/AnimatedPathsHausVomNikolaus.mp4">ç»˜åˆ¶æ™®é€šè·¯å¾„æ•ˆæœè§†é¢‘</a></p>

<p><a href="http://oleb.net/media/AnimatedPathsHausVomNikolaus.mp4">ä¸‹è½½åœ°å€</a></p>

<p>è¿™ä¸ªå¯¹æ–‡æœ¬ä¸€æ ·æœ‰æ•ˆï¼›æˆ‘ä»¬åªéœ€è¦æŠŠå­—ç¬¦è½¬åŒ–æˆ<code>CGPath</code>ã€‚<code>Core Text</code>æä¾›äº†é‚£æ ·çš„åŠŸèƒ½çš„å‡½æ•°ï¼Œ<a href="http://developer.apple.com/library/ios/documentation/Carbon/Reference/CTFontRef/Reference/reference.html#//apple_ref/c/func/CTFontCreatePathForGlyph">CTFontCreatePathForGlyph( )</a>ã€‚ä¸ºäº†ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¸¦å±æ€§çš„å­—ç¬¦ä¸²ç”¨æˆ‘ä»¬æƒ³è¦æ¸²æŸ“çš„æ–‡æœ¬ï¼Œå…ˆæŠŠå®ƒä»¬åˆ†å‰²æˆè¡Œåœ¨åˆ†å‰²æˆä¸€ä¸ªä¸ªå­—ç¬¦ã€‚åœ¨æŠŠæ‰€æœ‰çš„å­—ç¬¦è½¬æ¢æˆè·¯å¾„åï¼Œæˆ‘ä»¬ä»¥å­è·¯å¾„æ–¹å¼æŠŠå®ƒæ·»åŠ åˆ°ä¸€ä¸ªå•ä¸ªçš„<code>CGPath</code>è·¯å¾„ä¸­ã€‚æ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹<a href="http://www.codeproject.com/script/Membership/View.aspx?mid=2887692">Ohmu</a>å†™çš„<a href="http://www.codeproject.com/KB/iPhone/Glyph.aspx">Low-level text rendering</a>è¿™ç¯‡æ–‡ç« ã€‚ç»“æœçœ‹ä»¥æ¥éå¸¸çš„ç‚«é…·ï¼š</p>

<p><a href="http://oleb.net/media/AnimatedPathsHelloWorld.mp4">ç»˜åˆ¶æ–‡å­—è·¯å¾„æ•ˆæœè§†é¢‘</a></p>

<p><a href="http://oleb.net/media/AnimatedPathsHelloWorld.mp4">ä¸‹è½½åœ°å€</a></p>

<p>ä»Githubä¸Šè·å¾—<a href="http://github.com/ole/Animated-Paths">iPadç‰ˆçš„æ ·å“å·¥ç¨‹</a></p>

<h4>ä½ å°†å­¦åˆ°çš„çŸ¥è¯†ç‚¹</h4>

<ul>
<li>ä½¿ç”¨<code>CAShapeLayer</code>çš„<code>strokeStart</code>å’Œ<code>strokeEnd</code>æ¥å®ç°è·¯å¾„åŠ¨ç”»,æ¯”è¾ƒé«˜çº§å¤æ‚çš„æ•ˆæœåƒgoogleçš„ä¸‹æ‹‰åˆ·æ–°è½¬åœˆå°±å¯ä»¥ä»è¿™é‡Œå¼•ç”³å»å®ç°ã€‚</li>
<li><code>CABasicAnimation</code>å’Œ<code>CABasicAnimation</code>ä½¿ç”¨</li>
<li>æ·±å…¥ç†è§£<code>CAShapeLayer</code>å’Œ<code>CALayer</code></li>
<li>é€šè¿‡æ–‡æœ¬åˆ›å»ºè·¯å¾„ï¼Œæ ¸å¿ƒå‡½æ•°<code>CTFontCreatePathForGlyph()</code></li>
</ul>


<h4>è¡¥å……è¯´æ˜</h4>

<pre><code class="objective-c">    CAShapeLayer *pathLayer = [CAShapeLayer layer];
    pathLayer.frame = self.animationLayer.bounds;
    pathLayer.bounds = pathRect;
    pathLayer.geometryFlipped = YES;
    pathLayer.path = path.CGPath;
    pathLayer.strokeColor = [[UIColor blackColor] CGColor];
    pathLayer.fillColor = nil;
    pathLayer.lineWidth = 10.0f;
    pathLayer.lineJoin = kCALineJoinBevel;

    [self.animationLayer addSublayer:pathLayer];
</code></pre>

<p>æœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼ŒCALayeråœ¨iOSç³»ç»Ÿä¸­ç›¸å¯¹åæ ‡ç³»æ˜¯ä»¥å±å¹•å·¦ä¸Š<code>top-left</code>ä¸ºåæ ‡åŸç‚¹çš„ï¼Œåœ¨Mac OS Xä¸Šä»¥åä¸‹<code>bottom-left</code>ä¸ºåæ ‡åŸç‚¹,ä½†æ˜¯å¯ä»¥é€šè¿‡<code>CALayer</code>çš„æ¥å£<code>geometryFlipped</code>å‚ç›´ç¿»è½¬åæ ‡ç³»ï¼Œè¿™ä¸ªå€¼é»˜è®¤æ˜¯<code>NO</code>ï¼Œè®¾ç½®æˆ<code>YES</code>å°±å¯ä»¥æŠŠåæ ‡ç³»è½¬æ¢æˆå·¦ä¸‹<code>bottom-left</code>äº†ï¼Œè¿™é‡Œä½œè€…ä½¿ç”¨çš„å·¦ä¸‹<code>bottom-left</code>çš„åæ ‡ç³»ã€‚</p>

<pre><code class="objective-c">@property(getter=isGeometryFlipped) BOOL geometryFlipped;
</code></pre>

<p>å…³äºè¿™ä¸ªå±æ€§ä½¿ç”¨æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„</p>

<ol>
<li>ç¿»è½¬ä¼šåŒæ—¶ä½œç”¨äºå®ƒçš„å­å›¾å±‚</li>
<li>å³ä½¿è¿™ä¸ªå±æ€§è®¾ç½®æˆ<code>YES</code>,å›¾ç‰‡çš„<code>orientation</code>ä»ç„¶æ˜¯ä¸å˜çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´å½“è®¾ç½®<code>flipped=YES</code>å’Œ<code>flipped=NO</code>æ—¶ä¸€ä¸ª<code>CGImageRef</code>å‚¨å­˜åœ¨<code>contents</code>æ¥å£ä¸­çš„å†…å®¹å°†ä¼šæ˜¾ç¤ºä¸€è‡´ï¼Œèµ‹å€¼å¹¶ä¸ä¼šçœŸæ­£å˜æ¢åº•å±‚çš„å›¾å±‚ï¼‰</li>
</ol>


<h4>pathLayeråŠ¨ç”»å®ç°åŸç†</h4>

<ol>
<li>å…ˆåˆ›å»ºä¸€ä¸ªåŠ¨ç”»ç”¨çš„å›¾å±‚<code>animationLayer</code>ç±»å‹<code>CALayer</code>ï¼Œç”¨æ¥å……å½“åŠ¨ç”»çš„ç”»å¸ƒã€‚</li>
<li>åˆ›å»ºçœŸæ­£çš„è·¯å¾„å›¾å±‚<code>pathLayer</code>ç±»å‹ä¸º<code>CAShapeLayer</code>,è®©å®ƒçš„åæ ‡ç³»å‚ç›´ç¿»è½¬ï¼Œå¹¶ä¸”è®©å›¾å±‚å®½é«˜åŒæ—¶å‘å†…æ”¶ç¼©100ä¸ªç‚¹,é€šè¿‡<code>CGRectInset(CGRect rect, CGFloat dx, CGFloat dy)</code>å®ç°</li>
<li>æŠŠ<code>pathLayer</code>æ·»åŠ åˆ°<code>animationLayer</code>çš„å­å›¾å±‚ä¸­å»</li>
<li>åˆ›å»ºä¸€ä¸ªé“…ç¬”å›¾å±‚<code>penLayer</code>ç±»å‹ä¸º<code>CALayer</code>,æŠŠå®ƒæ·»åŠ åˆ°<code>pathLayer</code>å»</li>
<li>å¯¹<code>pathLayer</code>æ·»åŠ <code>CABasicAnimation</code>åŠ¨ç”»ï¼ŒåŠ¨ç”»å±æ€§ä¸º<code>strokeEnd</code></li>
<li>å¯¹<code>penLayer</code>æ·»åŠ <code>CAKeyframeAnimation</code>åŠ¨ç”»ï¼ŒåŠ¨ç”»å±æ€§ä¸º<code>position</code></li>
</ol>


<h4>textLayeråŠ¨ç”»å®ç°åŸç†</h4>

<ol>
<li>å…ˆåˆ›å»ºä¸€ä¸ªåŠ¨ç”»ç”¨çš„å›¾å±‚<code>animationLayer</code>ç±»å‹<code>CALayer</code>ï¼Œç”¨æ¥å……å½“åŠ¨ç”»çš„ç”»å¸ƒ</li>
<li>Create path from text,See:<a href="http://www.codeproject.com/KB/iPhone/Glyph.aspx">http://www.codeproject.com/KB/iPhone/Glyph.aspx</a>ï¼Œæœ€ç»ˆä¿å­˜åˆ°ä¸€ä¸ªç±»å‹ä¸º<code>CGMutablePathRef</code>çš„letterä¸­</li>
<li>é€šè¿‡letteræ¥åˆ›å»ºæ–‡å­—<code>UIBezierPath</code>ç±»å‹çš„<code>path</code></li>
<li>é€šè¿‡pathå†åˆ›å»º<code>CAShapeLayer</code>pathLayer,å¹¶ä¸”æŠŠpathLayeræ·»åŠ åˆ°<code>animationLayer</code>ä¸­å»</li>
<li>åˆ›å»ºä¸€ä¸ªé“…ç¬”å›¾å±‚<code>penLayer</code>ç±»å‹ä¸º<code>CALayer</code>,æŠŠå®ƒæ·»åŠ åˆ°<code>pathLayer</code>å»</li>
<li>å¯¹<code>pathLayer</code>æ·»åŠ <code>CABasicAnimation</code>åŠ¨ç”»ï¼ŒåŠ¨ç”»å±æ€§ä¸º<code>strokeEnd</code></li>
<li>å¯¹<code>penLayer</code>æ·»åŠ <code>CAKeyframeAnimation</code>åŠ¨ç”»ï¼ŒåŠ¨ç”»å±æ€§ä¸º<code>position</code></li>
</ol>


<h4>ä¿®å¤ä¸€å¤„bug</h4>

<p>é‡å¤ç‚¹å‡»<code>UISegmentedControl</code>å¯¼è‡´é“…ç¬”æ¶ˆå¤±ï¼Œè¿™æ˜¯è®¾ç½®äº†<code>penAnimation.delegate = self;</code>åœ¨ä»£ç†æ–¹æ³•é‡Œé¢æ²¡æœ‰åˆ¤æ–­ç»“æŸç›´æ¥å°†è®¾ç½®<code>self.penLayer.hidden = YES</code>ï¼Œå¯¼è‡´è¿ç»­åˆ‡æ¢æ—¶é“…ç¬”ä¸è§äº†ï¼Œè¦ä¿®å¤è¿™ä¸ªbugåªéœ€åŠ ä¸€ä¸ªåˆ¤æ–­<code>   if (flag)   self.penLayer.hidden = YES;
</code>å³å¯,è¿™æ ·çš„æ„æ€æ˜¯åªæœ‰å½“åŠ¨ç”»å®Œæˆæ—¶æ‰è®¾ç½®<code>self.penLayer.hidden</code>çš„å€¼ï¼Œå¥½äº†ç°åœ¨å·²ç»éå¸¸å®Œç¾äº†ï¼Œå¿«å»åŠ¨æ‰‹è‡ªå·±è¯•è¯•å§ï¼ğŸº</p>

<p>å¤‡æ³¨ï¼šæ¬¢è¿è½¬è½½ï¼Œä½†è¯·ä¸€å®šæ³¨æ˜å‡ºå¤„ï¼ <a href="http://blog.wangruofeng007.com">http://blog.wangruofeng007.com</a></p>
]]></content>
  </entry>
  
</feed>
